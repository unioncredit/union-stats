{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { newRidgeState } from \"react-ridge-state\";\nimport { signDaiPermit, signERC2612Permit } from \"eth-permit\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { PermitType } from \"constants/app\";\nexport var permitsState = newRidgeState({});\nexport default function usePermits() {\n  _s();\n\n  var _useWeb3React = useWeb3React(),\n      account = _useWeb3React.account,\n      library = _useWeb3React.library,\n      chainId = _useWeb3React.chainId;\n\n  var _permitsState$use = permitsState.use(),\n      _permitsState$use2 = _slicedToArray(_permitsState$use, 2),\n      permits = _permitsState$use2[0],\n      setPermits = _permitsState$use2[1];\n\n  var savePermit = function savePermit(key, permit) {\n    setPermits(function (x) {\n      return _objectSpread(_objectSpread({}, x), {}, _defineProperty({}, key, permit));\n    });\n  };\n\n  var removePermit = function removePermit(key) {\n    setPermits(function (x) {\n      return _objectSpread(_objectSpread({}, x), {}, _defineProperty({}, key, null));\n    });\n  };\n\n  var getPermit = function getPermit(key) {\n    var permit = permits[key];\n    var expiry = (permit === null || permit === void 0 ? void 0 : permit.expiry) || (permit === null || permit === void 0 ? void 0 : permit.deadline);\n    var permitValid = expiry && BigNumber.from(expiry).gt(Math.floor(Date.now() / 1000));\n\n    if (!permitValid) {\n      return null;\n    }\n\n    return permit;\n  };\n\n  var signPermit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(key, tokenAddress, spender, amount, permitType) {\n      var signFn, signFnArgs, token, permit;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              signFn = permitType === PermitType.DAI && chainId == 1 ? signDaiPermit : signERC2612Permit;\n              signFnArgs = permitType === PermitType.DAI && chainId == 1 ? [] : [amount];\n              token = chainId == 42161 && permitType === PermitType.DAI ? {\n                name: \"Dai Stablecoin\",\n                version: \"2\",\n                chainId: chainId,\n                verifyingContract: tokenAddress\n              } : tokenAddress;\n              _context.next = 5;\n              return signFn.apply(void 0, [library.provider, token, account, spender].concat(signFnArgs));\n\n            case 5:\n              permit = _context.sent;\n              savePermit(key, permit);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function signPermit(_x, _x2, _x3, _x4, _x5) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return {\n    savePermit: savePermit,\n    removePermit: removePermit,\n    getPermit: getPermit,\n    signPermit: signPermit\n  };\n}\n\n_s(usePermits, \"pTNk0OVn9qPHgCCNxwp4GwKRnjE=\", false, function () {\n  return [useWeb3React];\n});","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/hooks/usePermits.js"],"names":["newRidgeState","signDaiPermit","signERC2612Permit","useWeb3React","BigNumber","PermitType","permitsState","usePermits","account","library","chainId","use","permits","setPermits","savePermit","key","permit","x","removePermit","getPermit","expiry","deadline","permitValid","from","gt","Math","floor","Date","now","signPermit","tokenAddress","spender","amount","permitType","signFn","DAI","signFnArgs","token","name","version","verifyingContract","provider"],"mappings":"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","sourcesContent":["import { newRidgeState } from \"react-ridge-state\";\nimport { signDaiPermit, signERC2612Permit } from \"eth-permit\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { PermitType } from \"constants/app\";\n\nexport const permitsState = newRidgeState({});\n\nexport default function usePermits() {\n  const { account, library, chainId } = useWeb3React();\n  const [permits, setPermits] = permitsState.use();\n\n  const savePermit = (key, permit) => {\n    setPermits((x) => ({ ...x, [key]: permit }));\n  };\n\n  const removePermit = (key) => {\n    setPermits((x) => ({ ...x, [key]: null }));\n  };\n\n  const getPermit = (key) => {\n    const permit = permits[key];\n\n    const expiry = permit?.expiry || permit?.deadline;\n\n    const permitValid =\n      expiry && BigNumber.from(expiry).gt(Math.floor(Date.now() / 1000));\n\n    if (!permitValid) {\n      return null;\n    }\n\n    return permit;\n  };\n\n  const signPermit = async (key, tokenAddress, spender, amount, permitType) => {\n    const signFn =\n      permitType === PermitType.DAI && chainId == 1\n        ? signDaiPermit\n        : signERC2612Permit;\n\n    const signFnArgs =\n      permitType === PermitType.DAI && chainId == 1 ? [] : [amount];\n\n    const token =\n      chainId == 42161 && permitType === PermitType.DAI\n        ? {\n            name: \"Dai Stablecoin\",\n            version: \"2\",\n            chainId,\n            verifyingContract: tokenAddress,\n          }\n        : tokenAddress;\n    const permit = await signFn(\n      library.provider,\n      token,\n      account,\n      spender,\n      ...signFnArgs\n    );\n\n    savePermit(key, permit);\n  };\n\n  return { savePermit, removePermit, getPermit, signPermit };\n}\n"]},"metadata":{},"sourceType":"module"}