{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/VouchModal.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useRouter } from \"next/router\";\nimport { useForm } from \"react-hook-form\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { isAddress } from \"@ethersproject/address\";\nimport Info from \"@unioncredit/ui/lib/icons/wireInfo.svg\";\nimport { ModalOverlay, Box, Input, Button, Alert } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport useAddressLabels from \"hooks/useAddressLabels\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport isHash from \"util/isHash\";\nimport getReceipt from \"util/getReceipt\";\nimport errorMessages from \"util/errorMessages\";\nimport handleTxError from \"util/handleTxError\";\nimport activityLabels from \"util/activityLabels\";\nimport truncateAddress from \"util/truncateAddress\";\nimport { Dai, MiniAccountSummary, Modal, AddressInput } from \"components-ui\";\nimport { generateHandleChange } from \"components-ui/AddressInput\";\nimport useMaxTrust from \"hooks/useMaxTrust\";\nexport var VOUCH_MODAL = \"vouch-modal\";\nexport var useVouchModal = function useVouchModal() {\n  _s();\n\n  return useModal(VOUCH_MODAL);\n};\n\n_s(useVouchModal, \"/NNgIfWkZNRQc9ayPIFGjHDwfuE=\", false, function () {\n  return [useModal];\n});\n\nexport function VouchModal() {\n  _s2();\n\n  var _errors$address, _errors$address2, _errors$amount;\n\n  var _useRouter = useRouter(),\n      query = _useRouter.query,\n      events = _useRouter.events;\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library,\n      account = _useWeb3React.account;\n\n  var _useVouchModal = useVouchModal(),\n      close = _useVouchModal.close;\n\n  var addActivity = useAddActivity();\n\n  var _useTrustData = useTrustData(),\n      trustData = _useTrustData.data,\n      updateTrustData = _useTrustData.mutate;\n\n  var _useAddressLabels = useAddressLabels(),\n      setLabel = _useAddressLabels.setLabel;\n\n  var adjustTrust = useAdjustTrust();\n  var defaultAddressValue = query === null || query === void 0 ? void 0 : query.address;\n\n  var _useForm = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n    defaultValues: {\n      address: defaultAddressValue\n    }\n  }),\n      formState = _useForm.formState,\n      handleSubmit = _useForm.handleSubmit,\n      register = _useForm.register,\n      errors = _useForm.errors,\n      watch = _useForm.watch,\n      setValue = _useForm.setValue,\n      setError = _useForm.setError,\n      clearErrors = _useForm.clearErrors;\n\n  var isDirty = formState.isDirty,\n      isSubmitting = formState.isSubmitting;\n  useEffect(function () {\n    register(\"address\");\n  }, []);\n  useEffect(function () {\n    var handleComplete = function handleComplete() {\n      return close();\n    };\n\n    events.on(\"routeChangeComplete\", handleComplete);\n    return function () {\n      events.off(\"routeChangeComplete\", handleComplete);\n    };\n  }, []);\n\n  var onNavigateToProfile = function onNavigateToProfile() {\n    close();\n  };\n\n  var watchAddress = watch(\"address\");\n  var address = isAddress(watchAddress) && watchAddress;\n\n  var handleNewVouch = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data) {\n      var _yield$adjustTrust, hash, _hash;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return adjustTrust(data.address, data.amount);\n\n            case 3:\n              _yield$adjustTrust = _context.sent;\n              hash = _yield$adjustTrust.hash;\n              setLabel(data.address, data.alias);\n              _context.next = 8;\n              return getReceipt(hash, library, {\n                pending: \"Vouching \".concat(data.amount, \" DAI for \").concat(truncateAddress(data.address)),\n                success: \"Vouched \".concat(data.amount, \" DAI for \").concat(truncateAddress(data.address))\n              });\n\n            case 8:\n              addActivity(activityLabels.newVouch({\n                address: data.address,\n                amount: data.amount,\n                hash: hash\n              }));\n              _context.next = 11;\n              return updateTrustData();\n\n            case 11:\n              close();\n              _context.next = 19;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](0);\n              _hash = isHash(_context.t0.message) && _context.t0.message;\n              addActivity(activityLabels.newVouch({\n                address: data.address,\n                amount: data.amount,\n                hash: _hash\n              }, true));\n              handleTxError(_context.t0, \"Failed to vouch \".concat(data.amount, \" DAI\"));\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 14]]);\n    }));\n\n    return function handleNewVouch(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleAddressInputChange = generateHandleChange({\n    clearErrors: clearErrors,\n    setValue: setValue,\n    setError: setError,\n    validate: function validate(address) {\n      if (address.toLowerCase() === account.toLowerCase()) {\n        return errorMessages.notVouchSelf;\n      }\n\n      return true;\n    }\n  });\n  var maxTrust = useMaxTrust();\n  var maxTrustData = (trustData === null || trustData === void 0 ? void 0 : trustData.length) >= maxTrust;\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"New vouch\",\n      onClose: close,\n      children: [/*#__PURE__*/_jsxDEV(MiniAccountSummary, {\n        onClick: onNavigateToProfile,\n        address: !((_errors$address = errors.address) !== null && _errors$address !== void 0 && _errors$address.message) && address\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleNewVouch),\n        children: [/*#__PURE__*/_jsxDEV(AddressInput, {\n          name: \"address\",\n          label: \"Address or ENS\",\n          disabled: maxTrustData,\n          placeholder: \"e.g. 0xA1e3...\",\n          error: (_errors$address2 = errors.address) === null || _errors$address2 === void 0 ? void 0 : _errors$address2.message,\n          onChange: handleAddressInputChange,\n          defaultValue: defaultAddressValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"8px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            ref: register,\n            name: \"alias\",\n            label: \"Alias\",\n            disabled: maxTrustData,\n            placeholder: \"e.g. Halkyone Olga\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"16px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            ref: register({\n              required: errorMessages.required,\n              min: {\n                value: 1.0,\n                message: errorMessages.minValueOnePointZero\n              }\n            }),\n            suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 23\n            }, this),\n            name: \"amount\",\n            type: \"number\",\n            label: \"Trust amount\",\n            placeholder: \"0.0\",\n            disabled: maxTrustData,\n            error: errors === null || errors === void 0 ? void 0 : (_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"32px\",\n          direction: \"vertical\",\n          children: [maxTrustData && /*#__PURE__*/_jsxDEV(Alert, {\n            packed: true,\n            size: \"small\",\n            label: \"You have reached the max trust limit of \".concat(trustData === null || trustData === void 0 ? void 0 : trustData.length, \" vouches\"),\n            icon: /*#__PURE__*/_jsxDEV(Info, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 23\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            fluid: true,\n            mt: \"8px\",\n            type: \"submit\",\n            loading: isSubmitting,\n            disabled: !isDirty || maxTrustData,\n            label: \"Confirm vouch\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(VouchModal, \"2avExa+YStsQvferyuAYTB0pH8A=\", false, function () {\n  return [useRouter, useWeb3React, useVouchModal, useAddActivity, useTrustData, useAddressLabels, useAdjustTrust, useForm, useMaxTrust];\n});\n\n_c = VouchModal;\nVouchModal.propTypes = {\n  onNext: PropTypes.func.isRequired\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"VouchModal\");","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/VouchModal.js"],"names":["useEffect","PropTypes","useRouter","useForm","useWeb3React","isAddress","Info","ModalOverlay","Box","Input","Button","Alert","useModal","useTrustData","useAddressLabels","useAddActivity","useAdjustTrust","isHash","getReceipt","errorMessages","handleTxError","activityLabels","truncateAddress","Dai","MiniAccountSummary","Modal","AddressInput","generateHandleChange","useMaxTrust","VOUCH_MODAL","useVouchModal","VouchModal","query","events","library","account","close","addActivity","trustData","data","updateTrustData","mutate","setLabel","adjustTrust","defaultAddressValue","address","mode","reValidateMode","defaultValues","formState","handleSubmit","register","errors","watch","setValue","setError","clearErrors","isDirty","isSubmitting","handleComplete","on","off","onNavigateToProfile","watchAddress","handleNewVouch","amount","hash","alias","pending","success","newVouch","message","handleAddressInputChange","validate","toLowerCase","notVouchSelf","maxTrust","maxTrustData","length","required","min","value","minValueOnePointZero","propTypes","onNext","func","isRequired"],"mappings":"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","sourcesContent":["import { useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useRouter } from \"next/router\";\nimport { useForm } from \"react-hook-form\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { isAddress } from \"@ethersproject/address\";\nimport Info from \"@unioncredit/ui/lib/icons/wireInfo.svg\";\nimport { ModalOverlay, Box, Input, Button, Alert } from \"@unioncredit/ui\";\n\nimport { useModal } from \"hooks/useModal\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport useAddressLabels from \"hooks/useAddressLabels\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport isHash from \"util/isHash\";\nimport getReceipt from \"util/getReceipt\";\nimport errorMessages from \"util/errorMessages\";\nimport handleTxError from \"util/handleTxError\";\nimport activityLabels from \"util/activityLabels\";\nimport truncateAddress from \"util/truncateAddress\";\nimport { Dai, MiniAccountSummary, Modal, AddressInput } from \"components-ui\";\nimport { generateHandleChange } from \"components-ui/AddressInput\";\nimport useMaxTrust from \"hooks/useMaxTrust\";\n\nexport const VOUCH_MODAL = \"vouch-modal\";\n\nexport const useVouchModal = () => useModal(VOUCH_MODAL);\n\nexport function VouchModal() {\n  const { query, events } = useRouter();\n  const { library, account } = useWeb3React();\n  const { close } = useVouchModal();\n  const addActivity = useAddActivity();\n  const { data: trustData, mutate: updateTrustData } = useTrustData();\n  const { setLabel } = useAddressLabels();\n\n  const adjustTrust = useAdjustTrust();\n\n  const defaultAddressValue = query?.address;\n\n  const {\n    formState,\n    handleSubmit,\n    register,\n    errors,\n    watch,\n    setValue,\n    setError,\n    clearErrors,\n  } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n    defaultValues: { address: defaultAddressValue },\n  });\n  const { isDirty, isSubmitting } = formState;\n\n  useEffect(() => {\n    register(\"address\");\n  }, []);\n\n  useEffect(() => {\n    const handleComplete = () => close();\n    events.on(\"routeChangeComplete\", handleComplete);\n    return () => {\n      events.off(\"routeChangeComplete\", handleComplete);\n    };\n  }, []);\n\n  const onNavigateToProfile = () => {\n    close();\n  };\n\n  const watchAddress = watch(\"address\");\n  const address = isAddress(watchAddress) && watchAddress;\n\n  const handleNewVouch = async (data) => {\n    try {\n      const { hash } = await adjustTrust(data.address, data.amount);\n      setLabel(data.address, data.alias);\n      await getReceipt(hash, library, {\n        pending: `Vouching ${data.amount} DAI for ${truncateAddress(\n          data.address\n        )}`,\n        success: `Vouched ${data.amount} DAI for ${truncateAddress(\n          data.address\n        )}`,\n      });\n      addActivity(\n        activityLabels.newVouch({\n          address: data.address,\n          amount: data.amount,\n          hash,\n        })\n      );\n      await updateTrustData();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(\n        activityLabels.newVouch(\n          { address: data.address, amount: data.amount, hash },\n          true\n        )\n      );\n      handleTxError(err, `Failed to vouch ${data.amount} DAI`);\n    }\n  };\n\n  const handleAddressInputChange = generateHandleChange({\n    clearErrors,\n    setValue,\n    setError,\n    validate: (address) => {\n      if (address.toLowerCase() === account.toLowerCase()) {\n        return errorMessages.notVouchSelf;\n      }\n      return true;\n    },\n  });\n\n  const maxTrust = useMaxTrust();\n\n  const maxTrustData = trustData?.length >= maxTrust;\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"New vouch\" onClose={close}>\n        <MiniAccountSummary\n          onClick={onNavigateToProfile}\n          address={!errors.address?.message && address}\n        />\n        <form onSubmit={handleSubmit(handleNewVouch)}>\n          <AddressInput\n            name=\"address\"\n            label=\"Address or ENS\"\n            disabled={maxTrustData}\n            placeholder=\"e.g. 0xA1e3...\"\n            error={errors.address?.message}\n            onChange={handleAddressInputChange}\n            defaultValue={defaultAddressValue}\n          />\n          <Box mt=\"8px\">\n            <Input\n              ref={register}\n              name=\"alias\"\n              label=\"Alias\"\n              disabled={maxTrustData}\n              placeholder=\"e.g. Halkyone Olga\"\n            />\n          </Box>\n          <Box mt=\"16px\">\n            <Input\n              ref={register({\n                required: errorMessages.required,\n                min: {\n                  value: 1.0,\n                  message: errorMessages.minValueOnePointZero,\n                },\n              })}\n              suffix={<Dai />}\n              name=\"amount\"\n              type=\"number\"\n              label=\"Trust amount\"\n              placeholder=\"0.0\"\n              disabled={maxTrustData}\n              error={errors?.amount?.message}\n            />\n          </Box>\n          <Box mt=\"32px\" direction=\"vertical\">\n            {maxTrustData && (\n              <Alert\n                packed\n                size=\"small\"\n                label={`You have reached the max trust limit of ${trustData?.length} vouches`}\n                icon={<Info />}\n              />\n            )}\n            <Button\n              fluid\n              mt=\"8px\"\n              type=\"submit\"\n              loading={isSubmitting}\n              disabled={!isDirty || maxTrustData}\n              label=\"Confirm vouch\"\n            />\n          </Box>\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n\nVouchModal.propTypes = {\n  onNext: PropTypes.func.isRequired,\n};\n"]},"metadata":{},"sourceType":"module"}