{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { formatUnits } from \"@ethersproject/units\";\nimport useGovernanceContract from \"hooks/contracts/useGovernanceContract\";\nimport useReadProvider from \"hooks/useReadProvider\";\nimport useSWR from \"swr\";\nimport useAllProposalData from \"./useAllProposalData\";\n\nvar getProposalVoteHistory = function getProposalVoteHistory(govContract, proposals) {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_, address) {\n      var allProposalsWithReceipt;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return Promise.all(proposals.map( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(proposal) {\n                  var receipt, formattedReceipt;\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.next = 2;\n                          return govContract.getReceipt(proposal.pid, address);\n\n                        case 2:\n                          receipt = _context.sent;\n                          formattedReceipt = {\n                            hasVoted: receipt.hasVoted,\n                            support: receipt.support,\n                            votes: formatUnits(receipt.votes.toString(), 18)\n                          };\n                          return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, proposal), {}, {\n                            receipt: formattedReceipt\n                          }));\n\n                        case 5:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function (_x3) {\n                  return _ref2.apply(this, arguments);\n                };\n              }()));\n\n            case 2:\n              allProposalsWithReceipt = _context2.sent;\n              return _context2.abrupt(\"return\", allProposalsWithReceipt);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};\n\nexport default function useUserProposalVoteHistory(address) {\n  _s();\n\n  var readProvider = useReadProvider();\n  var govContract = useGovernanceContract(readProvider);\n\n  var _useAllProposalData = useAllProposalData(),\n      proposals = _useAllProposalData.data;\n\n  var shouldFetch = typeof address === \"string\" && govContract && proposals;\n  return useSWR(shouldFetch ? [\"ProposalVoteHistory\", address, proposals] : null, getProposalVoteHistory(govContract, proposals));\n}\n\n_s(useUserProposalVoteHistory, \"Pmax0CIeLb+2Mi2wft6kV/A0bGM=\", false, function () {\n  return [useReadProvider, useGovernanceContract, useAllProposalData, useSWR];\n});","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/hooks/governance/useUserProposalVoteHistory.js"],"names":["formatUnits","useGovernanceContract","useReadProvider","useSWR","useAllProposalData","getProposalVoteHistory","govContract","proposals","_","address","Promise","all","map","proposal","getReceipt","pid","receipt","formattedReceipt","hasVoted","support","votes","toString","allProposalsWithReceipt","useUserProposalVoteHistory","readProvider","data","shouldFetch"],"mappings":";;;;;;;;;;AAAA,SAASA,WAAT,QAA4B,sBAA5B;AACA,OAAOC,qBAAP,MAAkC,uCAAlC;AACA,OAAOC,eAAP,MAA4B,uBAA5B;AACA,OAAOC,MAAP,MAAmB,KAAnB;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;;AAEA,IAAMC,sBAAsB,GAC1B,SADIA,sBACJ,CAACC,WAAD,EAAcC,SAAd;AAAA;AAAA,wEAA4B,kBAAOC,CAAP,EAAUC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACYC,OAAO,CAACC,GAAR,CACpCJ,SAAS,CAACK,GAAV;AAAA,qFAAc,iBAAOC,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCACUP,WAAW,CAACQ,UAAZ,CAAuBD,QAAQ,CAACE,GAAhC,EAAqCN,OAArC,CADV;;AAAA;AACNO,0BAAAA,OADM;AAGNC,0BAAAA,gBAHM,GAGa;AACvBC,4BAAAA,QAAQ,EAAEF,OAAO,CAACE,QADK;AAEvBC,4BAAAA,OAAO,EAAEH,OAAO,CAACG,OAFM;AAGvBC,4BAAAA,KAAK,EAAEpB,WAAW,CAACgB,OAAO,CAACI,KAAR,CAAcC,QAAd,EAAD,EAA2B,EAA3B;AAHK,2BAHb;AAAA,2FAUPR,QAVO;AAWVG,4BAAAA,OAAO,EAAEC;AAXC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAd;;AAAA;AAAA;AAAA;AAAA,kBADoC,CADZ;;AAAA;AACpBK,cAAAA,uBADoB;AAAA,gDAkBnBA,uBAlBmB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA5B;;AAAA;AAAA;AAAA;AAAA;AAAA,CADF;;AAsBA,eAAe,SAASC,0BAAT,CAAoCd,OAApC,EAA6C;AAAA;;AAC1D,MAAMe,YAAY,GAAGtB,eAAe,EAApC;AACA,MAAMI,WAAW,GAAGL,qBAAqB,CAACuB,YAAD,CAAzC;;AAF0D,4BAI9BpB,kBAAkB,EAJY;AAAA,MAI5CG,SAJ4C,uBAIlDkB,IAJkD;;AAM1D,MAAMC,WAAW,GAAG,OAAOjB,OAAP,KAAmB,QAAnB,IAA+BH,WAA/B,IAA8CC,SAAlE;AAEA,SAAOJ,MAAM,CACXuB,WAAW,GAAG,CAAC,qBAAD,EAAwBjB,OAAxB,EAAiCF,SAAjC,CAAH,GAAiD,IADjD,EAEXF,sBAAsB,CAACC,WAAD,EAAcC,SAAd,CAFX,CAAb;AAID;;GAZuBgB,0B;UACDrB,e,EACDD,qB,EAEQG,kB,EAIrBD,M","sourcesContent":["import { formatUnits } from \"@ethersproject/units\";\nimport useGovernanceContract from \"hooks/contracts/useGovernanceContract\";\nimport useReadProvider from \"hooks/useReadProvider\";\nimport useSWR from \"swr\";\nimport useAllProposalData from \"./useAllProposalData\";\n\nconst getProposalVoteHistory =\n  (govContract, proposals) => async (_, address) => {\n    const allProposalsWithReceipt = await Promise.all(\n      proposals.map(async (proposal) => {\n        const receipt = await govContract.getReceipt(proposal.pid, address);\n\n        const formattedReceipt = {\n          hasVoted: receipt.hasVoted,\n          support: receipt.support,\n          votes: formatUnits(receipt.votes.toString(), 18),\n        };\n\n        return {\n          ...proposal,\n          receipt: formattedReceipt,\n        };\n      })\n    );\n\n    return allProposalsWithReceipt;\n  };\n\nexport default function useUserProposalVoteHistory(address) {\n  const readProvider = useReadProvider();\n  const govContract = useGovernanceContract(readProvider);\n\n  const { data: proposals } = useAllProposalData();\n\n  const shouldFetch = typeof address === \"string\" && govContract && proposals;\n\n  return useSWR(\n    shouldFetch ? [\"ProposalVoteHistory\", address, proposals] : null,\n    getProposalVoteHistory(govContract, proposals)\n  );\n}\n"]},"metadata":{},"sourceType":"module"}