{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/BorrowModal.js\";\nimport { ModalOverlay, Box, Input, Grid, Stat, Button, Label } from \"@unioncredit/ui\";\nimport { Modal, Dai } from \"components-ui\";\nimport { useModal } from \"hooks/useModal\";\nimport format from \"util/formatValue\";\nimport { roundDown } from \"util/numbers\";\nimport { useForm } from \"react-hook-form\";\nimport errorMessages from \"util/errorMessages\";\nimport useMaxBorrow from \"hooks/data/useMaxBorrow\";\nimport useLoanableAmount from \"hooks/data/useLoanableAmount\";\nimport useBorrow from \"hooks/payables/useBorrow\";\nimport handleTxError from \"util/handleTxError\";\nimport getReceipt from \"util/getReceipt\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nimport useMinBorrow from \"hooks/stats/marketSettingsStats/useMinBorrow\";\nimport { commify } from \"@ethersproject/units\";\nexport const BORROW_MODAL = \"borrow-modal\";\nexport const useBorrowModal = () => useModal(BORROW_MODAL);\nexport function BorrowModal({\n  balanceOwed,\n  fee,\n  creditLimit,\n  paymentDueDate,\n  paymentPeriod,\n  isOverdue,\n  onComplete\n}) {\n  var _errors$amount;\n\n  const addActivity = useAddActivity();\n  const {\n    library\n  } = useWeb3React();\n  const borrow = useBorrow();\n  const {\n    close\n  } = useBorrowModal();\n  const {\n    data: maxBorrow\n  } = useMaxBorrow();\n  const {\n    data: loanableAmount\n  } = useLoanableAmount();\n  const {\n    data: minBorrow\n  } = useMinBorrow();\n  const {\n    errors,\n    formState,\n    register,\n    watch,\n    handleSubmit,\n    setValue\n  } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\"\n  });\n  const {\n    isDirty,\n    isSubmitting\n  } = formState;\n  const watchAmount = watch(\"amount\", 0);\n  const amount = Number(watchAmount || 0);\n  const calcBalanceOwed = balanceOwed > 0 ? balanceOwed : 0;\n  const calcMaxIncludingFee = roundDown(creditLimit * (1 - fee));\n  const calculateFee = amount === calcMaxIncludingFee ? roundDown(creditLimit * fee) : amount * fee;\n  const amountWithFee = amount + calculateFee;\n  const calcNewBalanceOwed = calcBalanceOwed + amountWithFee;\n  const newBalanceOwed = calcNewBalanceOwed.toFixed(2);\n  const nextPaymentDue = paymentDueDate !== \"-\" && paymentDueDate !== \"No Payment Due\" && calcBalanceOwed > 0 ? paymentDueDate : paymentPeriod;\n\n  const validate = async val => {\n    if (!val) return errorMessages.required;\n    if (isOverdue) return errorMessages.overdueBalance;\n    if (isNaN(val)) return errorMessages.notANumber;\n    if (Number(val) > calcMaxIncludingFee) return errorMessages.notEnoughCredit;\n    if (Number(val) > maxBorrow) return errorMessages.maxBorrow(maxBorrow);\n    if (Number(val) > loanableAmount) return errorMessages.notEnoughPoolDAI;\n    if (Number(val) < minBorrow) return errorMessages.minDAIBorrow(minBorrow);\n    return true;\n  };\n\n  const handleBorrow = async data => {\n    try {\n      const {\n        amount\n      } = data;\n      const {\n        hash\n      } = await borrow(amount);\n      await getReceipt(hash, library, {\n        pending: `Borrowing ${amount} DAI`,\n        success: `Borrowed ${amount} DAI`\n      });\n      if (typeof onComplete === \"function\") onComplete();\n      addActivity(activityLabels.borrow({\n        amount,\n        hash\n      }));\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(activityLabels.borrow({\n        amount: data.amount,\n        hash\n      }, true));\n      handleTxError(err, `Failed to borrow ${amount} DAI`);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Borrow funds\",\n      onClose: close,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleBorrow),\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          children: /*#__PURE__*/_jsxDEV(Grid.Row, {\n            children: [/*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"Available credit\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(roundDown(creditLimit))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 121,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 117,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"You owe\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: balanceOwed\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 129,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"24px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            type: \"number\",\n            ref: register({\n              validate\n            }),\n            name: \"amount\",\n            label: \"Borrow\",\n            placeholder: \"0.0\",\n            suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 23\n            }, this),\n            caption: `Max. ${format(calcMaxIncludingFee)} DAI`,\n            onCaptionClick: () => setValue(\"amount\", calcMaxIncludingFee, {\n              shouldValidate: true,\n              shouldDirty: true\n            }),\n            error: ((_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message) || false\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          mt: \"16px\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"Total including fee\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: [commify(amountWithFee), \" DAI\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"First Payment Due\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: nextPaymentDue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"New balance owed\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: [commify(newBalanceOwed), \" DAI\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fluid: true,\n          mt: \"18px\",\n          label: `Borrow ${commify(amount)} DAI`,\n          disabled: !isDirty,\n          loading: isSubmitting,\n          onClick: handleSubmit(handleBorrow),\n          fontSize: \"large\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/BorrowModal.js"],"names":["ModalOverlay","Box","Input","Grid","Stat","Button","Label","Modal","Dai","useModal","format","roundDown","useForm","errorMessages","useMaxBorrow","useLoanableAmount","useBorrow","handleTxError","getReceipt","useWeb3React","useAddActivity","activityLabels","isHash","useMinBorrow","commify","BORROW_MODAL","useBorrowModal","BorrowModal","balanceOwed","fee","creditLimit","paymentDueDate","paymentPeriod","isOverdue","onComplete","addActivity","library","borrow","close","data","maxBorrow","loanableAmount","minBorrow","errors","formState","register","watch","handleSubmit","setValue","mode","reValidateMode","isDirty","isSubmitting","watchAmount","amount","Number","calcBalanceOwed","calcMaxIncludingFee","calculateFee","amountWithFee","calcNewBalanceOwed","newBalanceOwed","toFixed","nextPaymentDue","validate","val","required","overdueBalance","isNaN","notANumber","notEnoughCredit","notEnoughPoolDAI","minDAIBorrow","handleBorrow","hash","pending","success","err","message","shouldValidate","shouldDirty"],"mappings":"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","sourcesContent":["import {\n  ModalOverlay,\n  Box,\n  Input,\n  Grid,\n  Stat,\n  Button,\n  Label,\n} from \"@unioncredit/ui\";\nimport { Modal, Dai } from \"components-ui\";\nimport { useModal } from \"hooks/useModal\";\nimport format from \"util/formatValue\";\nimport { roundDown } from \"util/numbers\";\nimport { useForm } from \"react-hook-form\";\nimport errorMessages from \"util/errorMessages\";\nimport useMaxBorrow from \"hooks/data/useMaxBorrow\";\nimport useLoanableAmount from \"hooks/data/useLoanableAmount\";\nimport useBorrow from \"hooks/payables/useBorrow\";\nimport handleTxError from \"util/handleTxError\";\nimport getReceipt from \"util/getReceipt\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nimport useMinBorrow from \"hooks/stats/marketSettingsStats/useMinBorrow\";\nimport { commify } from \"@ethersproject/units\";\n\nexport const BORROW_MODAL = \"borrow-modal\";\n\nexport const useBorrowModal = () => useModal(BORROW_MODAL);\n\nexport function BorrowModal({\n  balanceOwed,\n  fee,\n  creditLimit,\n  paymentDueDate,\n  paymentPeriod,\n  isOverdue,\n  onComplete,\n}) {\n  const addActivity = useAddActivity();\n  const { library } = useWeb3React();\n  const borrow = useBorrow();\n  const { close } = useBorrowModal();\n  const { data: maxBorrow } = useMaxBorrow();\n  const { data: loanableAmount } = useLoanableAmount();\n  const { data: minBorrow } = useMinBorrow();\n\n  const { errors, formState, register, watch, handleSubmit, setValue } =\n    useForm({\n      mode: \"onChange\",\n      reValidateMode: \"onChange\",\n    });\n\n  const { isDirty, isSubmitting } = formState;\n\n  const watchAmount = watch(\"amount\", 0);\n  const amount = Number(watchAmount || 0);\n\n  const calcBalanceOwed = balanceOwed > 0 ? balanceOwed : 0;\n\n  const calcMaxIncludingFee = roundDown(creditLimit * (1 - fee));\n\n  const calculateFee =\n    amount === calcMaxIncludingFee\n      ? roundDown(creditLimit * fee)\n      : amount * fee;\n\n  const amountWithFee = amount + calculateFee;\n  const calcNewBalanceOwed = calcBalanceOwed + amountWithFee;\n  const newBalanceOwed = calcNewBalanceOwed.toFixed(2);\n\n  const nextPaymentDue =\n    paymentDueDate !== \"-\" &&\n    paymentDueDate !== \"No Payment Due\" &&\n    calcBalanceOwed > 0\n      ? paymentDueDate\n      : paymentPeriod;\n\n  const validate = async (val) => {\n    if (!val) return errorMessages.required;\n    if (isOverdue) return errorMessages.overdueBalance;\n    if (isNaN(val)) return errorMessages.notANumber;\n    if (Number(val) > calcMaxIncludingFee) return errorMessages.notEnoughCredit;\n    if (Number(val) > maxBorrow) return errorMessages.maxBorrow(maxBorrow);\n    if (Number(val) > loanableAmount) return errorMessages.notEnoughPoolDAI;\n    if (Number(val) < minBorrow) return errorMessages.minDAIBorrow(minBorrow);\n\n    return true;\n  };\n\n  const handleBorrow = async (data) => {\n    try {\n      const { amount } = data;\n      const { hash } = await borrow(amount);\n      await getReceipt(hash, library, {\n        pending: `Borrowing ${amount} DAI`,\n        success: `Borrowed ${amount} DAI`,\n      });\n      if (typeof onComplete === \"function\") onComplete();\n      addActivity(activityLabels.borrow({ amount, hash }));\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(activityLabels.borrow({ amount: data.amount, hash }, true));\n      handleTxError(err, `Failed to borrow ${amount} DAI`);\n    }\n  };\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"Borrow funds\" onClose={close}>\n        <form onSubmit={handleSubmit(handleBorrow)}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Available credit\"\n                  value={<Dai value={format(roundDown(creditLimit))} />}\n                />\n              </Grid.Col>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"You owe\"\n                  value={<Dai value={balanceOwed} />}\n                />\n              </Grid.Col>\n            </Grid.Row>\n          </Grid>\n          <Box mt=\"24px\">\n            <Input\n              type=\"number\"\n              ref={register({ validate })}\n              name=\"amount\"\n              label=\"Borrow\"\n              placeholder=\"0.0\"\n              suffix={<Dai />}\n              caption={`Max. ${format(calcMaxIncludingFee)} DAI`}\n              onCaptionClick={() =>\n                setValue(\"amount\", calcMaxIncludingFee, {\n                  shouldValidate: true,\n                  shouldDirty: true,\n                })\n              }\n              error={errors.amount?.message || false}\n            />\n          </Box>\n          <Box justify=\"space-between\" mt=\"16px\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              Total including fee\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {commify(amountWithFee)} DAI\n            </Label>\n          </Box>\n          <Box justify=\"space-between\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              First Payment Due\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {nextPaymentDue}\n            </Label>\n          </Box>\n          <Box justify=\"space-between\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              New balance owed\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {commify(newBalanceOwed)} DAI\n            </Label>\n          </Box>\n          <Button\n            fluid\n            mt=\"18px\"\n            label={`Borrow ${commify(amount)} DAI`}\n            disabled={!isDirty}\n            loading={isSubmitting}\n            onClick={handleSubmit(handleBorrow)}\n            fontSize=\"large\"\n          />\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}