{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/Approval.js\",\n    _defaultApprovalTypeT,\n    _s = $RefreshSig$();\n\nimport { Card, Button, Box, Label } from \"@unioncredit/ui\";\nimport Switch from \"@unioncredit/ui/lib/icons/switch.svg\";\nimport Check from \"@unioncredit/ui/lib/icons/wireCheck.svg\";\nimport useAllowance from \"hooks/useAllowance\";\nimport { parseEther } from \"@ethersproject/units\";\nimport { useState } from \"react\";\nimport usePermits from \"hooks/usePermits\";\nimport { PermitType, ApprovalTypes } from \"constants/app\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport styles from \"./approval.module.css\";\nvar defaultApprovalTypeText = (_defaultApprovalTypeT = {}, _defineProperty(_defaultApprovalTypeT, ApprovalTypes.SIGNATURE, \"Approving with permit\"), _defineProperty(_defaultApprovalTypeT, ApprovalTypes.TRANSACTION, \"Approving with transaction\"), _defaultApprovalTypeT);\n/**\n * returns an approval button is there is not enough allowance\n *\n * @param {string} signatureKey - storage key for this signature data\n * @param {string} approvalType - transaction or signature\n * @param {number} amount - amount to approve for\n * @param {string} spender - address who is the spender\n * @param {string} tokenAddress - address of the approval token\n */\n\nexport function Approval(_ref) {\n  _s();\n\n  var signatureKey = _ref.signatureKey,\n      amount = _ref.amount,\n      children = _ref.children,\n      spender = _ref.spender,\n      tokenAddress = _ref.tokenAddress,\n      disabled = _ref.disabled,\n      _ref$label = _ref.label,\n      label = _ref$label === void 0 ? \"Approve\" : _ref$label,\n      _ref$permitType = _ref.permitType,\n      permitType = _ref$permitType === void 0 ? PermitType.DAI : _ref$permitType,\n      _ref$approvalType = _ref.approvalType,\n      initialApprovalType = _ref$approvalType === void 0 ? ApprovalTypes.TRANSACTION : _ref$approvalType,\n      _ref$approvalTypeText = _ref.approvalTypeText,\n      approvalTypeText = _ref$approvalTypeText === void 0 ? defaultApprovalTypeText : _ref$approvalTypeText;\n\n  var _useAllowance = useAllowance(tokenAddress, spender, signatureKey),\n      approve = _useAllowance.approve,\n      allowance = _useAllowance.data,\n      updateAllowance = _useAllowance.mutate,\n      approveWithSignature = _useAllowance.approveWithSignature;\n\n  var _usePermits = usePermits(),\n      getPermit = _usePermits.getPermit;\n\n  var _useState = useState(initialApprovalType),\n      approvalType = _useState[0],\n      setApprovalType = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var permit = getPermit(signatureKey);\n  var parsedAmount = amount instanceof BigNumber ? amount : parseEther(amount.toString());\n\n  var handleApproval = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n\n              if (!(approvalType === ApprovalTypes.SIGNATURE)) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.prev = 2;\n              _context.next = 5;\n              return approveWithSignature(parsedAmount.toString(), permitType);\n\n            case 5:\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](2);\n              setLoading(false);\n\n            case 10:\n              _context.next = 15;\n              break;\n\n            case 12:\n              if (!(approvalType === ApprovalTypes.TRANSACTION)) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.next = 15;\n              return approve();\n\n            case 15:\n              _context.next = 17;\n              return updateAllowance();\n\n            case 17:\n              setLoading(false);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 7]]);\n    }));\n\n    return function handleApproval() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var toggleApprovalType = function toggleApprovalType() {\n    setApprovalType(function (type) {\n      return type === ApprovalTypes.TRANSACTION ? ApprovalTypes.SIGNATURE : ApprovalTypes.TRANSACTION;\n    });\n  };\n\n  var typeText = approvalTypeText[approvalType];\n\n  if (!permit && (parsedAmount.lte(\"0\") || allowance !== null && allowance !== void 0 && allowance.lt(parsedAmount))) {\n    return /*#__PURE__*/_jsxDEV(Card, {\n      variant: \"blue\",\n      packed: true,\n      className: styles.card,\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        fluid: true,\n        mt: \"4px\",\n        mb: \"10px\",\n        align: \"center\",\n        justify: \"center\",\n        onClick: disabled ? undefined : toggleApprovalType,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.switchIcon,\n          children: /*#__PURE__*/_jsxDEV(Switch, {\n            width: \"24px\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Label, {\n          m: 0,\n          as: \"p\",\n          style: {\n            cursor: \"pointer\"\n          },\n          size: \"small\",\n          color: \"blue500\",\n          align: \"center\",\n          children: typeText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        fluid: true,\n        loading: loading,\n        label: label,\n        disabled: disabled,\n        onClick: handleApproval\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Card, {\n    variant: \"blue\",\n    packed: true,\n    className: styles.card,\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      fluid: true,\n      mt: \"4px\",\n      mb: \"10px\",\n      align: \"center\",\n      justify: \"center\",\n      onClick: toggleApprovalType,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.switchIcon,\n        children: /*#__PURE__*/_jsxDEV(Check, {\n          width: \"24px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Label, {\n        m: 0,\n        as: \"p\",\n        size: \"small\",\n        color: \"blue500\",\n        align: \"center\",\n        children: \"Approved\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this), children]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Approval, \"IRoF8OCaDXDCemiwf2OKwzvnaxg=\", false, function () {\n  return [useAllowance, usePermits];\n});\n\n_c = Approval;\n\nvar _c;\n\n$RefreshReg$(_c, \"Approval\");","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/Approval.js"],"names":["Card","Button","Box","Label","Switch","Check","useAllowance","parseEther","useState","usePermits","PermitType","ApprovalTypes","BigNumber","styles","defaultApprovalTypeText","SIGNATURE","TRANSACTION","Approval","signatureKey","amount","children","spender","tokenAddress","disabled","label","permitType","DAI","approvalType","initialApprovalType","approvalTypeText","approve","allowance","data","updateAllowance","mutate","approveWithSignature","getPermit","setApprovalType","loading","setLoading","permit","parsedAmount","toString","handleApproval","toggleApprovalType","type","typeText","lte","lt","card","undefined","switchIcon","cursor"],"mappings":"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","sourcesContent":["import { Card, Button, Box, Label } from \"@unioncredit/ui\";\nimport Switch from \"@unioncredit/ui/lib/icons/switch.svg\";\nimport Check from \"@unioncredit/ui/lib/icons/wireCheck.svg\";\n\nimport useAllowance from \"hooks/useAllowance\";\nimport { parseEther } from \"@ethersproject/units\";\nimport { useState } from \"react\";\nimport usePermits from \"hooks/usePermits\";\nimport { PermitType, ApprovalTypes } from \"constants/app\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\n\nimport styles from \"./approval.module.css\";\n\nconst defaultApprovalTypeText = {\n  [ApprovalTypes.SIGNATURE]: \"Approving with permit\",\n  [ApprovalTypes.TRANSACTION]: \"Approving with transaction\",\n};\n\n/**\n * returns an approval button is there is not enough allowance\n *\n * @param {string} signatureKey - storage key for this signature data\n * @param {string} approvalType - transaction or signature\n * @param {number} amount - amount to approve for\n * @param {string} spender - address who is the spender\n * @param {string} tokenAddress - address of the approval token\n */\nexport function Approval({\n  signatureKey,\n  amount,\n  children,\n  spender,\n  tokenAddress,\n  disabled,\n  label = \"Approve\",\n  permitType = PermitType.DAI,\n  approvalType: initialApprovalType = ApprovalTypes.TRANSACTION,\n  approvalTypeText = defaultApprovalTypeText,\n}) {\n  const {\n    approve,\n    data: allowance,\n    mutate: updateAllowance,\n    approveWithSignature,\n  } = useAllowance(tokenAddress, spender, signatureKey);\n  const { getPermit } = usePermits();\n  const [approvalType, setApprovalType] = useState(initialApprovalType);\n\n  const [loading, setLoading] = useState(false);\n\n  const permit = getPermit(signatureKey);\n\n  const parsedAmount =\n    amount instanceof BigNumber ? amount : parseEther(amount.toString());\n\n  const handleApproval = async () => {\n    setLoading(true);\n    if (approvalType === ApprovalTypes.SIGNATURE) {\n      try {\n        await approveWithSignature(parsedAmount.toString(), permitType);\n      } catch (_) {\n        setLoading(false);\n      }\n    } else if (approvalType === ApprovalTypes.TRANSACTION) {\n      await approve();\n    }\n\n    await updateAllowance();\n    setLoading(false);\n  };\n\n  const toggleApprovalType = () => {\n    setApprovalType((type) => {\n      return type === ApprovalTypes.TRANSACTION\n        ? ApprovalTypes.SIGNATURE\n        : ApprovalTypes.TRANSACTION;\n    });\n  };\n\n  const typeText = approvalTypeText[approvalType];\n\n  if (!permit && (parsedAmount.lte(\"0\") || allowance?.lt(parsedAmount))) {\n    return (\n      <Card variant=\"blue\" packed className={styles.card}>\n        <Box\n          fluid\n          mt=\"4px\"\n          mb=\"10px\"\n          align=\"center\"\n          justify=\"center\"\n          onClick={disabled ? undefined : toggleApprovalType}\n        >\n          <div className={styles.switchIcon}>\n            <Switch width=\"24px\" />\n          </div>\n          <Label\n            m={0}\n            as=\"p\"\n            style={{ cursor: \"pointer\" }}\n            size=\"small\"\n            color=\"blue500\"\n            align=\"center\"\n          >\n            {typeText}\n          </Label>\n        </Box>\n        <Button\n          fluid\n          loading={loading}\n          label={label}\n          disabled={disabled}\n          onClick={handleApproval}\n        />\n      </Card>\n    );\n  }\n\n  return (\n    <Card variant=\"blue\" packed className={styles.card}>\n      <Box\n        fluid\n        mt=\"4px\"\n        mb=\"10px\"\n        align=\"center\"\n        justify=\"center\"\n        onClick={toggleApprovalType}\n      >\n        <div className={styles.switchIcon}>\n          <Check width=\"24px\" />\n        </div>\n        <Label m={0} as=\"p\" size=\"small\" color=\"blue500\" align=\"center\">\n          Approved\n        </Label>\n      </Box>\n      {children}\n    </Card>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}