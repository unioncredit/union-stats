{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/VouchModal.js\";\nimport { useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useRouter } from \"next/router\";\nimport { useForm } from \"react-hook-form\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { isAddress } from \"@ethersproject/address\";\nimport Info from \"@unioncredit/ui/lib/icons/wireInfo.svg\";\nimport { ModalOverlay, Box, Input, Button, Alert } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport useAddressLabels from \"hooks/useAddressLabels\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport isHash from \"util/isHash\";\nimport getReceipt from \"util/getReceipt\";\nimport errorMessages from \"util/errorMessages\";\nimport handleTxError from \"util/handleTxError\";\nimport activityLabels from \"util/activityLabels\";\nimport truncateAddress from \"util/truncateAddress\";\nimport { Dai, MiniAccountSummary, Modal, AddressInput } from \"components-ui\";\nimport { generateHandleChange } from \"components-ui/AddressInput\";\nimport useMaxTrust from \"hooks/useMaxTrust\";\nexport const VOUCH_MODAL = \"vouch-modal\";\nexport const useVouchModal = () => useModal(VOUCH_MODAL);\nexport function VouchModal() {\n  var _errors$address, _errors$address2, _errors$amount;\n\n  const {\n    query,\n    events\n  } = useRouter();\n  const {\n    library,\n    account\n  } = useWeb3React();\n  const {\n    close\n  } = useVouchModal();\n  const addActivity = useAddActivity();\n  const {\n    data: trustData,\n    mutate: updateTrustData\n  } = useTrustData();\n  const {\n    setLabel\n  } = useAddressLabels();\n  const adjustTrust = useAdjustTrust();\n  const defaultAddressValue = query === null || query === void 0 ? void 0 : query.address;\n  const {\n    formState,\n    handleSubmit,\n    register,\n    errors,\n    watch,\n    setValue,\n    setError,\n    clearErrors\n  } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n    defaultValues: {\n      address: defaultAddressValue\n    }\n  });\n  const {\n    isDirty,\n    isSubmitting\n  } = formState;\n  useEffect(() => {\n    register(\"address\");\n  }, []);\n  useEffect(() => {\n    const handleComplete = () => close();\n\n    events.on(\"routeChangeComplete\", handleComplete);\n    return () => {\n      events.off(\"routeChangeComplete\", handleComplete);\n    };\n  }, []);\n\n  const onNavigateToProfile = () => {\n    close();\n  };\n\n  const watchAddress = watch(\"address\");\n  const address = isAddress(watchAddress) && watchAddress;\n\n  const handleNewVouch = async data => {\n    try {\n      const {\n        hash\n      } = await adjustTrust(data.address, data.amount);\n      setLabel(data.address, data.alias);\n      await getReceipt(hash, library, {\n        pending: `Vouching ${data.amount} DAI for ${truncateAddress(data.address)}`,\n        success: `Vouched ${data.amount} DAI for ${truncateAddress(data.address)}`\n      });\n      addActivity(activityLabels.newVouch({\n        address: data.address,\n        amount: data.amount,\n        hash\n      }));\n      await updateTrustData();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(activityLabels.newVouch({\n        address: data.address,\n        amount: data.amount,\n        hash\n      }, true));\n      handleTxError(err, `Failed to vouch ${data.amount} DAI`);\n    }\n  };\n\n  const handleAddressInputChange = generateHandleChange({\n    clearErrors,\n    setValue,\n    setError,\n    validate: address => {\n      if (address.toLowerCase() === account.toLowerCase()) {\n        return errorMessages.notVouchSelf;\n      }\n\n      return true;\n    }\n  });\n  const maxTrust = useMaxTrust();\n  const maxTrustData = (trustData === null || trustData === void 0 ? void 0 : trustData.length) >= maxTrust;\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"New vouch\",\n      onClose: close,\n      children: [/*#__PURE__*/_jsxDEV(MiniAccountSummary, {\n        onClick: onNavigateToProfile,\n        address: !((_errors$address = errors.address) !== null && _errors$address !== void 0 && _errors$address.message) && address\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleNewVouch),\n        children: [/*#__PURE__*/_jsxDEV(AddressInput, {\n          name: \"address\",\n          label: \"Address or ENS\",\n          disabled: maxTrustData,\n          placeholder: \"e.g. 0xA1e3...\",\n          error: (_errors$address2 = errors.address) === null || _errors$address2 === void 0 ? void 0 : _errors$address2.message,\n          onChange: handleAddressInputChange,\n          defaultValue: defaultAddressValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"8px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            ref: register,\n            name: \"alias\",\n            label: \"Alias\",\n            disabled: maxTrustData,\n            placeholder: \"e.g. Halkyone Olga\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"16px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            ref: register({\n              required: errorMessages.required,\n              min: {\n                value: 1.0,\n                message: errorMessages.minValueOnePointZero\n              }\n            }),\n            suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 23\n            }, this),\n            name: \"amount\",\n            type: \"number\",\n            label: \"Trust amount\",\n            placeholder: \"0.0\",\n            disabled: maxTrustData,\n            error: errors === null || errors === void 0 ? void 0 : (_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"32px\",\n          direction: \"vertical\",\n          children: [maxTrustData && /*#__PURE__*/_jsxDEV(Alert, {\n            packed: true,\n            size: \"small\",\n            label: `You have reached the max trust limit of ${trustData === null || trustData === void 0 ? void 0 : trustData.length} vouches`,\n            icon: /*#__PURE__*/_jsxDEV(Info, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 23\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            fluid: true,\n            mt: \"8px\",\n            type: \"submit\",\n            loading: isSubmitting,\n            disabled: !isDirty || maxTrustData,\n            label: \"Confirm vouch\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n}\nVouchModal.propTypes = {\n  onNext: PropTypes.func.isRequired\n};","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/VouchModal.js"],"names":["useEffect","PropTypes","useRouter","useForm","useWeb3React","isAddress","Info","ModalOverlay","Box","Input","Button","Alert","useModal","useTrustData","useAddressLabels","useAddActivity","useAdjustTrust","isHash","getReceipt","errorMessages","handleTxError","activityLabels","truncateAddress","Dai","MiniAccountSummary","Modal","AddressInput","generateHandleChange","useMaxTrust","VOUCH_MODAL","useVouchModal","VouchModal","query","events","library","account","close","addActivity","data","trustData","mutate","updateTrustData","setLabel","adjustTrust","defaultAddressValue","address","formState","handleSubmit","register","errors","watch","setValue","setError","clearErrors","mode","reValidateMode","defaultValues","isDirty","isSubmitting","handleComplete","on","off","onNavigateToProfile","watchAddress","handleNewVouch","hash","amount","alias","pending","success","newVouch","err","message","handleAddressInputChange","validate","toLowerCase","notVouchSelf","maxTrust","maxTrustData","length","required","min","value","minValueOnePointZero","propTypes","onNext","func","isRequired"],"mappings":"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","sourcesContent":["import { useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useRouter } from \"next/router\";\nimport { useForm } from \"react-hook-form\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { isAddress } from \"@ethersproject/address\";\nimport Info from \"@unioncredit/ui/lib/icons/wireInfo.svg\";\nimport { ModalOverlay, Box, Input, Button, Alert } from \"@unioncredit/ui\";\n\nimport { useModal } from \"hooks/useModal\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport useAddressLabels from \"hooks/useAddressLabels\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport isHash from \"util/isHash\";\nimport getReceipt from \"util/getReceipt\";\nimport errorMessages from \"util/errorMessages\";\nimport handleTxError from \"util/handleTxError\";\nimport activityLabels from \"util/activityLabels\";\nimport truncateAddress from \"util/truncateAddress\";\nimport { Dai, MiniAccountSummary, Modal, AddressInput } from \"components-ui\";\nimport { generateHandleChange } from \"components-ui/AddressInput\";\nimport useMaxTrust from \"hooks/useMaxTrust\";\n\nexport const VOUCH_MODAL = \"vouch-modal\";\n\nexport const useVouchModal = () => useModal(VOUCH_MODAL);\n\nexport function VouchModal() {\n  const { query, events } = useRouter();\n  const { library, account } = useWeb3React();\n  const { close } = useVouchModal();\n  const addActivity = useAddActivity();\n  const { data: trustData, mutate: updateTrustData } = useTrustData();\n  const { setLabel } = useAddressLabels();\n\n  const adjustTrust = useAdjustTrust();\n\n  const defaultAddressValue = query?.address;\n\n  const {\n    formState,\n    handleSubmit,\n    register,\n    errors,\n    watch,\n    setValue,\n    setError,\n    clearErrors,\n  } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n    defaultValues: { address: defaultAddressValue },\n  });\n  const { isDirty, isSubmitting } = formState;\n\n  useEffect(() => {\n    register(\"address\");\n  }, []);\n\n  useEffect(() => {\n    const handleComplete = () => close();\n    events.on(\"routeChangeComplete\", handleComplete);\n    return () => {\n      events.off(\"routeChangeComplete\", handleComplete);\n    };\n  }, []);\n\n  const onNavigateToProfile = () => {\n    close();\n  };\n\n  const watchAddress = watch(\"address\");\n  const address = isAddress(watchAddress) && watchAddress;\n\n  const handleNewVouch = async (data) => {\n    try {\n      const { hash } = await adjustTrust(data.address, data.amount);\n      setLabel(data.address, data.alias);\n      await getReceipt(hash, library, {\n        pending: `Vouching ${data.amount} DAI for ${truncateAddress(\n          data.address\n        )}`,\n        success: `Vouched ${data.amount} DAI for ${truncateAddress(\n          data.address\n        )}`,\n      });\n      addActivity(\n        activityLabels.newVouch({\n          address: data.address,\n          amount: data.amount,\n          hash,\n        })\n      );\n      await updateTrustData();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(\n        activityLabels.newVouch(\n          { address: data.address, amount: data.amount, hash },\n          true\n        )\n      );\n      handleTxError(err, `Failed to vouch ${data.amount} DAI`);\n    }\n  };\n\n  const handleAddressInputChange = generateHandleChange({\n    clearErrors,\n    setValue,\n    setError,\n    validate: (address) => {\n      if (address.toLowerCase() === account.toLowerCase()) {\n        return errorMessages.notVouchSelf;\n      }\n      return true;\n    },\n  });\n\n  const maxTrust = useMaxTrust();\n\n  const maxTrustData = trustData?.length >= maxTrust;\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"New vouch\" onClose={close}>\n        <MiniAccountSummary\n          onClick={onNavigateToProfile}\n          address={!errors.address?.message && address}\n        />\n        <form onSubmit={handleSubmit(handleNewVouch)}>\n          <AddressInput\n            name=\"address\"\n            label=\"Address or ENS\"\n            disabled={maxTrustData}\n            placeholder=\"e.g. 0xA1e3...\"\n            error={errors.address?.message}\n            onChange={handleAddressInputChange}\n            defaultValue={defaultAddressValue}\n          />\n          <Box mt=\"8px\">\n            <Input\n              ref={register}\n              name=\"alias\"\n              label=\"Alias\"\n              disabled={maxTrustData}\n              placeholder=\"e.g. Halkyone Olga\"\n            />\n          </Box>\n          <Box mt=\"16px\">\n            <Input\n              ref={register({\n                required: errorMessages.required,\n                min: {\n                  value: 1.0,\n                  message: errorMessages.minValueOnePointZero,\n                },\n              })}\n              suffix={<Dai />}\n              name=\"amount\"\n              type=\"number\"\n              label=\"Trust amount\"\n              placeholder=\"0.0\"\n              disabled={maxTrustData}\n              error={errors?.amount?.message}\n            />\n          </Box>\n          <Box mt=\"32px\" direction=\"vertical\">\n            {maxTrustData && (\n              <Alert\n                packed\n                size=\"small\"\n                label={`You have reached the max trust limit of ${trustData?.length} vouches`}\n                icon={<Info />}\n              />\n            )}\n            <Button\n              fluid\n              mt=\"8px\"\n              type=\"submit\"\n              loading={isSubmitting}\n              disabled={!isDirty || maxTrustData}\n              label=\"Confirm vouch\"\n            />\n          </Box>\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n\nVouchModal.propTypes = {\n  onNext: PropTypes.func.isRequired,\n};\n"]},"metadata":{},"sourceType":"module"}