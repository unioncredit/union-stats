{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/EditVouchModal.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { Grid, Button, ModalOverlay, Input, Stat } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport useCreditLimit from \"hooks/data/useCreditLimit\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nexport var EDIT_VOUCH_MODAL = \"edit-vouch-modal\";\nexport var useEditVouchModal = function useEditVouchModal() {\n  _s();\n\n  return useModal(EDIT_VOUCH_MODAL);\n};\n\n_s(useEditVouchModal, \"/NNgIfWkZNRQc9ayPIFGjHDwfuE=\", false, function () {\n  return [useModal];\n});\n\nexport function EditVouchModal(_ref) {\n  _s2();\n\n  var _errors$amount;\n\n  var address = _ref.address,\n      used = _ref.used,\n      trust = _ref.trust;\n  var addActivity = useAddActivity();\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library;\n\n  var _useEditVouchModal = useEditVouchModal(),\n      close = _useEditVouchModal.close;\n\n  var adjustTrust = useAdjustTrust();\n\n  var _useTrustData = useTrustData(),\n      updateTrustData = _useTrustData.mutate;\n\n  var _useCreditLimit = useCreditLimit(),\n      updateCreditLimit = _useCreditLimit.mutate;\n\n  var _useForm = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\"\n  }),\n      register = _useForm.register,\n      formState = _useForm.formState,\n      errors = _useForm.errors,\n      handleSubmit = _useForm.handleSubmit;\n\n  var isDirty = formState.isDirty,\n      isSubmitting = formState.isSubmitting;\n\n  var validate = function validate(val) {\n    if (Number(val) <= used) return errorMessages.cantRemoveStake;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n    return true;\n  };\n\n  var handleAdjustTrust = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n      var _yield$adjustTrust, hash, _hash;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return adjustTrust(address, values.amount);\n\n            case 3:\n              _yield$adjustTrust = _context.sent;\n              hash = _yield$adjustTrust.hash;\n              _context.next = 7;\n              return getReceipt(hash, library);\n\n            case 7:\n              addActivity(activityLabels.adjustVouch({\n                address: address,\n                amount: values.amount,\n                hash: hash\n              }));\n              _context.next = 10;\n              return updateTrustData();\n\n            case 10:\n              _context.next = 12;\n              return updateCreditLimit();\n\n            case 12:\n              close();\n              _context.next = 20;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](0);\n              _hash = isHash(_context.t0.message) && _context.t0.message;\n              addActivity(activityLabels.adjustVouch({\n                address: address,\n                amount: values.amount,\n                hash: _hash\n              }, true));\n              handleTxError(_context.t0);\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 15]]);\n    }));\n\n    return function handleAdjustTrust(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Change trust amount\",\n      onClose: close,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleAdjustTrust),\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          children: /*#__PURE__*/_jsxDEV(Grid.Row, {\n            children: [/*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                mb: \"24px\",\n                size: \"medium\",\n                align: \"center\",\n                label: \"Current trust\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(trust, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 77,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 72,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 71,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                mb: \"24px\",\n                size: \"medium\",\n                align: \"center\",\n                label: \"Unpaid debt\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(used, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 86,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 81,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 80,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          type: \"number\",\n          ref: register({\n            validate: validate\n          }),\n          name: \"amount\",\n          label: \"New trust amount\",\n          suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 21\n          }, this),\n          error: (_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          mt: \"18px\",\n          fluid: true,\n          label: \"Save\",\n          fontSize: \"large\",\n          type: \"submit\",\n          disabled: !isDirty,\n          loading: isSubmitting\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(EditVouchModal, \"PR7LHWCHBlSwzAXh4wU8nqUTO0I=\", false, function () {\n  return [useAddActivity, useWeb3React, useEditVouchModal, useAdjustTrust, useTrustData, useCreditLimit, useForm];\n});\n\n_c = EditVouchModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditVouchModal\");","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/EditVouchModal.js"],"names":["Grid","Button","ModalOverlay","Input","Stat","useModal","Dai","Modal","format","errorMessages","useForm","getReceipt","handleTxError","useAdjustTrust","useTrustData","useWeb3React","useCreditLimit","useAddActivity","activityLabels","isHash","EDIT_VOUCH_MODAL","useEditVouchModal","EditVouchModal","address","used","trust","addActivity","library","close","adjustTrust","updateTrustData","mutate","updateCreditLimit","mode","reValidateMode","register","formState","errors","handleSubmit","isDirty","isSubmitting","validate","val","Number","cantRemoveStake","minValueZero","required","handleAdjustTrust","values","amount","hash","adjustVouch","message"],"mappings":"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","sourcesContent":["import { Grid, Button, ModalOverlay, Input, Stat } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport useCreditLimit from \"hooks/data/useCreditLimit\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\n\nexport const EDIT_VOUCH_MODAL = \"edit-vouch-modal\";\n\nexport const useEditVouchModal = () => useModal(EDIT_VOUCH_MODAL);\n\nexport function EditVouchModal({ address, used, trust }) {\n  const addActivity = useAddActivity();\n  const { library } = useWeb3React();\n  const { close } = useEditVouchModal();\n  const adjustTrust = useAdjustTrust();\n  const { mutate: updateTrustData } = useTrustData();\n  const { mutate: updateCreditLimit } = useCreditLimit();\n\n  const { register, formState, errors, handleSubmit } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n  });\n  const { isDirty, isSubmitting } = formState;\n\n  const validate = (val) => {\n    if (Number(val) <= used) return errorMessages.cantRemoveStake;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n\n    return true;\n  };\n\n  const handleAdjustTrust = async (values) => {\n    try {\n      const { hash } = await adjustTrust(address, values.amount);\n      await getReceipt(hash, library);\n      addActivity(\n        activityLabels.adjustVouch({ address, amount: values.amount, hash })\n      );\n      await updateTrustData();\n      await updateCreditLimit();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(\n        activityLabels.adjustVouch(\n          { address, amount: values.amount, hash },\n          true\n        )\n      );\n      handleTxError(err);\n    }\n  };\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"Change trust amount\" onClose={close}>\n        <form onSubmit={handleSubmit(handleAdjustTrust)}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Col>\n                <Stat\n                  mb=\"24px\"\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Current trust\"\n                  value={<Dai value={format(trust, 4)} />}\n                />\n              </Grid.Col>\n              <Grid.Col>\n                <Stat\n                  mb=\"24px\"\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Unpaid debt\"\n                  value={<Dai value={format(used, 4)} />}\n                />\n              </Grid.Col>\n            </Grid.Row>\n          </Grid>\n          <Input\n            type=\"number\"\n            ref={register({ validate })}\n            name=\"amount\"\n            label=\"New trust amount\"\n            suffix={<Dai />}\n            error={errors.amount?.message}\n          />\n          <Button\n            mt=\"18px\"\n            fluid\n            label=\"Save\"\n            fontSize=\"large\"\n            type=\"submit\"\n            disabled={!isDirty}\n            loading={isSubmitting}\n          />\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}