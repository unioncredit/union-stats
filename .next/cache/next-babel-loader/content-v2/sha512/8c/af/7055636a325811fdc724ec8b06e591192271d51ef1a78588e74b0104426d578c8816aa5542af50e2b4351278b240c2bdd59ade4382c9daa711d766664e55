{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/WriteOffDebtModal.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { Label, Stat, Grid, Button, ModalOverlay, Input, Box } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { useManageContactModal } from \"components-ui/modals\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport useWriteOffDebt from \"hooks/payables/useWriteOffDebt\";\nimport isHash from \"util/isHash\";\nexport var WRITE_OFF_DEBT = \"write-off-debt-modal\";\nexport var useWriteOffDebtModal = function useWriteOffDebtModal() {\n  _s();\n\n  return useModal(WRITE_OFF_DEBT);\n};\n\n_s(useWriteOffDebtModal, \"/NNgIfWkZNRQc9ayPIFGjHDwfuE=\", false, function () {\n  return [useModal];\n});\n\nexport function WriteOffDebtModal(_ref) {\n  _s2();\n\n  var _errors$amount;\n\n  var address = _ref.address,\n      used = _ref.used,\n      vouched = _ref.vouched,\n      isOverdue = _ref.isOverdue;\n  var addActivity = useAddActivity();\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library;\n\n  var _useWriteOffDebtModal = useWriteOffDebtModal(),\n      close = _useWriteOffDebtModal.close;\n\n  var _useTrustData = useTrustData(),\n      updateTrustData = _useTrustData.mutate;\n\n  var _useManageContactModa = useManageContactModal(),\n      openManageContactModal = _useManageContactModa.open;\n\n  var writeOffDebt = useWriteOffDebt();\n\n  var _useForm = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\"\n  }),\n      register = _useForm.register,\n      watch = _useForm.watch,\n      formState = _useForm.formState,\n      errors = _useForm.errors,\n      setValue = _useForm.setValue,\n      handleSubmit = _useForm.handleSubmit;\n\n  var isDirty = formState.isDirty,\n      isSubmitting = formState.isSubmitting;\n  var watchAmount = watch(\"amount\");\n  var amount = Number(watchAmount || 0);\n\n  var validate = function validate(val) {\n    if (!isOverdue) return errorMessages.notOverDue;\n    if (Number(val) > used) return errorMessages.maxWriteOff;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n    return true;\n  };\n\n  var handleGoBack = function handleGoBack() {\n    close();\n    openManageContactModal();\n  };\n\n  var handleWriteOffDebt = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n      var _yield$writeOffDebt, hash, _hash;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return writeOffDebt(address, values.amount);\n\n            case 3:\n              _yield$writeOffDebt = _context.sent;\n              hash = _yield$writeOffDebt.hash;\n              _context.next = 7;\n              return getReceipt(hash, library);\n\n            case 7:\n              addActivity(activityLabels.writeOffDebt({\n                address: address,\n                amount: values.amount,\n                hash: hash\n              }));\n              _context.next = 10;\n              return updateTrustData();\n\n            case 10:\n              handleGoBack();\n              _context.next = 18;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](0);\n              _hash = isHash(_context.t0.message) && _context.t0.message;\n              addActivity(activityLabels.writeOffDebt({\n                address: address,\n                amount: values.amount,\n                hash: _hash\n              }, true));\n              handleTxError(_context.t0);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 13]]);\n    }));\n\n    return function handleWriteOffDebt(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleWriteOffMax = function handleWriteOffMax() {\n    setValue(\"amount\", used, {\n      shouldDirty: true,\n      shouldValidate: true\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Write-off debt\",\n      onClose: close,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleWriteOffDebt),\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          children: /*#__PURE__*/_jsxDEV(Grid.Row, {\n            children: [/*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"Vouch\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(vouched, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 100,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"Unpaid debt\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(used, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 108,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 104,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 103,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          type: \"number\",\n          ref: register({\n            validate: validate\n          }),\n          name: \"amount\",\n          label: \"Value\",\n          suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 21\n          }, this),\n          caption: \"Write off max.\",\n          error: (_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message,\n          onCaptionClick: handleWriteOffMax\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          mt: \"16px\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            m: 0,\n            children: \"New balance owed\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            m: 0,\n            children: format(used - amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Label, {\n          align: \"center\",\n          as: \"p\",\n          size: \"small\",\n          color: \"red500\",\n          mt: \"16px\",\n          children: \"When you write-off debt, your locked funds are consumed, this action cannot be undone.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fluid: true,\n          label: \"Write-off debt\",\n          type: \"submit\",\n          loading: isSubmitting,\n          disabled: !isDirty\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(WriteOffDebtModal, \"U6b8bY2n4GVCKUbWB5tczilU11c=\", false, function () {\n  return [useAddActivity, useWeb3React, useWriteOffDebtModal, useTrustData, useManageContactModal, useWriteOffDebt, useForm];\n});\n\n_c = WriteOffDebtModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"WriteOffDebtModal\");","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/WriteOffDebtModal.js"],"names":["Label","Stat","Grid","Button","ModalOverlay","Input","Box","useModal","useManageContactModal","Dai","Modal","format","errorMessages","useForm","getReceipt","handleTxError","useTrustData","useWeb3React","useAddActivity","activityLabels","useWriteOffDebt","isHash","WRITE_OFF_DEBT","useWriteOffDebtModal","WriteOffDebtModal","address","used","vouched","isOverdue","addActivity","library","close","updateTrustData","mutate","openManageContactModal","open","writeOffDebt","mode","reValidateMode","register","watch","formState","errors","setValue","handleSubmit","isDirty","isSubmitting","watchAmount","amount","Number","validate","val","notOverDue","maxWriteOff","minValueZero","required","handleGoBack","handleWriteOffDebt","values","hash","message","handleWriteOffMax","shouldDirty","shouldValidate"],"mappings":";;;;;;;;AAAA,SACEA,KADF,EAEEC,IAFF,EAGEC,IAHF,EAIEC,MAJF,EAKEC,YALF,EAMEC,KANF,EAOEC,GAPF,QAQO,iBARP;AASA,SAASC,QAAT,QAAyB,gBAAzB;AACA,SAASC,qBAAT,QAAsC,sBAAtC;AACA,SAASC,GAAT,EAAcC,KAAd,QAA2B,eAA3B;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA,OAAOC,aAAP,MAA0B,oBAA1B;AACA,SAASC,OAAT,QAAwB,iBAAxB;AACA,OAAOC,UAAP,MAAuB,iBAAvB;AACA,OAAOC,aAAP,MAA0B,oBAA1B;AACA,OAAOC,YAAP,MAAyB,yBAAzB;AACA,SAASC,YAAT,QAA6B,kBAA7B;AACA,SAASC,cAAT,QAA+B,wBAA/B;AACA,OAAOC,cAAP,MAA2B,qBAA3B;AACA,OAAOC,eAAP,MAA4B,gCAA5B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,OAAO,IAAMC,cAAc,GAAG,sBAAvB;AAEP,OAAO,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB;AAAA;;AAAA,SAAMhB,QAAQ,CAACe,cAAD,CAAd;AAAA,CAA7B;;GAAMC,oB;UAA6BhB,Q;;;AAE1C,OAAO,SAASiB,iBAAT,OAAkE;AAAA;;AAAA;;AAAA,MAArCC,OAAqC,QAArCA,OAAqC;AAAA,MAA5BC,IAA4B,QAA5BA,IAA4B;AAAA,MAAtBC,OAAsB,QAAtBA,OAAsB;AAAA,MAAbC,SAAa,QAAbA,SAAa;AACvE,MAAMC,WAAW,GAAGX,cAAc,EAAlC;;AADuE,sBAEnDD,YAAY,EAFuC;AAAA,MAE/Da,OAF+D,iBAE/DA,OAF+D;;AAAA,8BAGrDP,oBAAoB,EAHiC;AAAA,MAG/DQ,KAH+D,yBAG/DA,KAH+D;;AAAA,sBAInCf,YAAY,EAJuB;AAAA,MAIvDgB,eAJuD,iBAI/DC,MAJ+D;;AAAA,8BAK9BzB,qBAAqB,EALS;AAAA,MAKzD0B,sBALyD,yBAK/DC,IAL+D;;AAMvE,MAAMC,YAAY,GAAGhB,eAAe,EAApC;;AANuE,iBASrEP,OAAO,CAAC;AACNwB,IAAAA,IAAI,EAAE,UADA;AAENC,IAAAA,cAAc,EAAE;AAFV,GAAD,CAT8D;AAAA,MAQ/DC,QAR+D,YAQ/DA,QAR+D;AAAA,MAQrDC,KARqD,YAQrDA,KARqD;AAAA,MAQ9CC,SAR8C,YAQ9CA,SAR8C;AAAA,MAQnCC,MARmC,YAQnCA,MARmC;AAAA,MAQ3BC,QAR2B,YAQ3BA,QAR2B;AAAA,MAQjBC,YARiB,YAQjBA,YARiB;;AAAA,MAa/DC,OAb+D,GAarCJ,SAbqC,CAa/DI,OAb+D;AAAA,MAatDC,YAbsD,GAarCL,SAbqC,CAatDK,YAbsD;AAevE,MAAMC,WAAW,GAAGP,KAAK,CAAC,QAAD,CAAzB;AACA,MAAMQ,MAAM,GAAGC,MAAM,CAACF,WAAW,IAAI,CAAhB,CAArB;;AAEA,MAAMG,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD,EAAS;AACxB,QAAI,CAACvB,SAAL,EAAgB,OAAOhB,aAAa,CAACwC,UAArB;AAChB,QAAIH,MAAM,CAACE,GAAD,CAAN,GAAczB,IAAlB,EAAwB,OAAOd,aAAa,CAACyC,WAArB;AACxB,QAAIJ,MAAM,CAACE,GAAD,CAAN,IAAe,CAAnB,EAAsB,OAAOvC,aAAa,CAAC0C,YAArB;AACtB,QAAI,CAACH,GAAL,EAAU,OAAOvC,aAAa,CAAC2C,QAArB;AAEV,WAAO,IAAP;AACD,GAPD;;AASA,MAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzBzB,IAAAA,KAAK;AACLG,IAAAA,sBAAsB;AACvB,GAHD;;AAKA,MAAMuB,kBAAkB;AAAA,yEAAG,iBAAOC,MAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEAtB,YAAY,CAACX,OAAD,EAAUiC,MAAM,CAACV,MAAjB,CAFZ;;AAAA;AAAA;AAEfW,cAAAA,IAFe,uBAEfA,IAFe;AAAA;AAAA,qBAGjB7C,UAAU,CAAC6C,IAAD,EAAO7B,OAAP,CAHO;;AAAA;AAIvBD,cAAAA,WAAW,CACTV,cAAc,CAACiB,YAAf,CAA4B;AAAEX,gBAAAA,OAAO,EAAPA,OAAF;AAAWuB,gBAAAA,MAAM,EAAEU,MAAM,CAACV,MAA1B;AAAkCW,gBAAAA,IAAI,EAAJA;AAAlC,eAA5B,CADS,CAAX;AAJuB;AAAA,qBAOjB3B,eAAe,EAPE;;AAAA;AAQvBwB,cAAAA,YAAY;AARW;AAAA;;AAAA;AAAA;AAAA;AAUjBG,cAAAA,KAViB,GAUVtC,MAAM,CAAC,YAAIuC,OAAL,CAAN,IAAuB,YAAIA,OAVjB;AAWvB/B,cAAAA,WAAW,CACTV,cAAc,CAACiB,YAAf,CACE;AAAEX,gBAAAA,OAAO,EAAPA,OAAF;AAAWuB,gBAAAA,MAAM,EAAEU,MAAM,CAACV,MAA1B;AAAkCW,gBAAAA,IAAI,EAAJA;AAAlC,eADF,EAEE,IAFF,CADS,CAAX;AAMA5C,cAAAA,aAAa,aAAb;;AAjBuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAlB0C,kBAAkB;AAAA;AAAA;AAAA,KAAxB;;AAqBA,MAAMI,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9BlB,IAAAA,QAAQ,CAAC,QAAD,EAAWjB,IAAX,EAAiB;AACvBoC,MAAAA,WAAW,EAAE,IADU;AAEvBC,MAAAA,cAAc,EAAE;AAFO,KAAjB,CAAR;AAID,GALD;;AAOA,sBACE,QAAC,YAAD;AAAc,IAAA,OAAO,EAAEhC,KAAvB;AAAA,2BACE,QAAC,KAAD;AAAO,MAAA,KAAK,EAAC,gBAAb;AAA8B,MAAA,OAAO,EAAEA,KAAvC;AAAA,6BACE;AAAM,QAAA,QAAQ,EAAEa,YAAY,CAACa,kBAAD,CAA5B;AAAA,gCACE,QAAC,IAAD;AAAA,iCACE,QAAC,IAAD,CAAM,GAAN;AAAA,oCACE,QAAC,IAAD,CAAM,GAAN;AAAA,qCACE,QAAC,IAAD;AACE,gBAAA,IAAI,EAAC,QADP;AAEE,gBAAA,KAAK,EAAC,QAFR;AAGE,gBAAA,KAAK,EAAC,OAHR;AAIE,gBAAA,KAAK,eAAE,QAAC,GAAD;AAAK,kBAAA,KAAK,EAAE9C,MAAM,CAACgB,OAAD,EAAU,CAAV;AAAlB;AAAA;AAAA;AAAA;AAAA;AAJT;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eASE,QAAC,IAAD,CAAM,GAAN;AAAA,qCACE,QAAC,IAAD;AACE,gBAAA,IAAI,EAAC,QADP;AAEE,gBAAA,KAAK,EAAC,QAFR;AAGE,gBAAA,KAAK,EAAC,aAHR;AAIE,gBAAA,KAAK,eAAE,QAAC,GAAD;AAAK,kBAAA,KAAK,EAAEhB,MAAM,CAACe,IAAD,EAAO,CAAP;AAAlB;AAAA;AAAA;AAAA;AAAA;AAJT;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBATF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAqBE,QAAC,KAAD;AACE,UAAA,IAAI,EAAC,QADP;AAEE,UAAA,GAAG,EAAEa,QAAQ,CAAC;AAAEW,YAAAA,QAAQ,EAARA;AAAF,WAAD,CAFf;AAGE,UAAA,IAAI,EAAC,QAHP;AAIE,UAAA,KAAK,EAAC,OAJR;AAKE,UAAA,MAAM,eAAE,QAAC,GAAD;AAAA;AAAA;AAAA;AAAA,kBALV;AAME,UAAA,OAAO,EAAC,gBANV;AAOE,UAAA,KAAK,oBAAER,MAAM,CAACM,MAAT,mDAAE,eAAeY,OAPxB;AAQE,UAAA,cAAc,EAAEC;AARlB;AAAA;AAAA;AAAA;AAAA,gBArBF,eA+BE,QAAC,GAAD;AAAK,UAAA,OAAO,EAAC,eAAb;AAA6B,UAAA,EAAE,EAAC,MAAhC;AAAA,kCACE,QAAC,KAAD;AAAO,YAAA,EAAE,EAAC,GAAV;AAAc,YAAA,IAAI,EAAC,OAAnB;AAA2B,YAAA,CAAC,EAAE,CAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAIE,QAAC,KAAD;AAAO,YAAA,EAAE,EAAC,GAAV;AAAc,YAAA,IAAI,EAAC,OAAnB;AAA2B,YAAA,CAAC,EAAE,CAA9B;AAAA,sBACGlD,MAAM,CAACe,IAAI,GAAGsB,MAAR;AADT;AAAA;AAAA;AAAA;AAAA,kBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,gBA/BF,eAuCE,QAAC,KAAD;AAAO,UAAA,KAAK,EAAC,QAAb;AAAsB,UAAA,EAAE,EAAC,GAAzB;AAA6B,UAAA,IAAI,EAAC,OAAlC;AAA0C,UAAA,KAAK,EAAC,QAAhD;AAAyD,UAAA,EAAE,EAAC,MAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAvCF,eA2CE,QAAC,MAAD;AACE,UAAA,KAAK,MADP;AAEE,UAAA,KAAK,EAAC,gBAFR;AAGE,UAAA,IAAI,EAAC,QAHP;AAIE,UAAA,OAAO,EAAEF,YAJX;AAKE,UAAA,QAAQ,EAAE,CAACD;AALb;AAAA;AAAA;AAAA;AAAA,gBA3CF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AAyDD;;IArHerB,iB;UACMN,c,EACAD,Y,EACFM,oB,EACkBP,Y,EACKR,qB,EACpBY,e,EAGnBP,O;;;KATYW,iB","sourcesContent":["import {\n  Label,\n  Stat,\n  Grid,\n  Button,\n  ModalOverlay,\n  Input,\n  Box,\n} from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { useManageContactModal } from \"components-ui/modals\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport useWriteOffDebt from \"hooks/payables/useWriteOffDebt\";\nimport isHash from \"util/isHash\";\n\nexport const WRITE_OFF_DEBT = \"write-off-debt-modal\";\n\nexport const useWriteOffDebtModal = () => useModal(WRITE_OFF_DEBT);\n\nexport function WriteOffDebtModal({ address, used, vouched, isOverdue }) {\n  const addActivity = useAddActivity();\n  const { library } = useWeb3React();\n  const { close } = useWriteOffDebtModal();\n  const { mutate: updateTrustData } = useTrustData();\n  const { open: openManageContactModal } = useManageContactModal();\n  const writeOffDebt = useWriteOffDebt();\n\n  const { register, watch, formState, errors, setValue, handleSubmit } =\n    useForm({\n      mode: \"onChange\",\n      reValidateMode: \"onChange\",\n    });\n  const { isDirty, isSubmitting } = formState;\n\n  const watchAmount = watch(\"amount\");\n  const amount = Number(watchAmount || 0);\n\n  const validate = (val) => {\n    if (!isOverdue) return errorMessages.notOverDue;\n    if (Number(val) > used) return errorMessages.maxWriteOff;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n\n    return true;\n  };\n\n  const handleGoBack = () => {\n    close();\n    openManageContactModal();\n  };\n\n  const handleWriteOffDebt = async (values) => {\n    try {\n      const { hash } = await writeOffDebt(address, values.amount);\n      await getReceipt(hash, library);\n      addActivity(\n        activityLabels.writeOffDebt({ address, amount: values.amount, hash })\n      );\n      await updateTrustData();\n      handleGoBack();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(\n        activityLabels.writeOffDebt(\n          { address, amount: values.amount, hash },\n          true\n        )\n      );\n      handleTxError(err);\n    }\n  };\n\n  const handleWriteOffMax = () => {\n    setValue(\"amount\", used, {\n      shouldDirty: true,\n      shouldValidate: true,\n    });\n  };\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"Write-off debt\" onClose={close}>\n        <form onSubmit={handleSubmit(handleWriteOffDebt)}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Vouch\"\n                  value={<Dai value={format(vouched, 4)} />}\n                />\n              </Grid.Col>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Unpaid debt\"\n                  value={<Dai value={format(used, 4)} />}\n                />\n              </Grid.Col>\n            </Grid.Row>\n          </Grid>\n          <Input\n            type=\"number\"\n            ref={register({ validate })}\n            name=\"amount\"\n            label=\"Value\"\n            suffix={<Dai />}\n            caption=\"Write off max.\"\n            error={errors.amount?.message}\n            onCaptionClick={handleWriteOffMax}\n          />\n          <Box justify=\"space-between\" mt=\"16px\">\n            <Label as=\"p\" size=\"small\" m={0}>\n              New balance owed\n            </Label>\n            <Label as=\"p\" size=\"small\" m={0}>\n              {format(used - amount)}\n            </Label>\n          </Box>\n          <Label align=\"center\" as=\"p\" size=\"small\" color=\"red500\" mt=\"16px\">\n            When you write-off debt, your locked funds are consumed, this action\n            cannot be undone.\n          </Label>\n          <Button\n            fluid\n            label=\"Write-off debt\"\n            type=\"submit\"\n            loading={isSubmitting}\n            disabled={!isDirty}\n          />\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}