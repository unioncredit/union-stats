{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mathewstokes/Desktop/stats-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/BorrowModal.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { ModalOverlay, Box, Input, Grid, Stat, Button, Label } from \"@unioncredit/ui\";\nimport { Modal, Dai } from \"components-ui\";\nimport { useModal } from \"hooks/useModal\";\nimport format from \"util/formatValue\";\nimport { roundDown } from \"util/numbers\";\nimport { useForm } from \"react-hook-form\";\nimport errorMessages from \"util/errorMessages\";\nimport useMaxBorrow from \"hooks/data/useMaxBorrow\";\nimport useLoanableAmount from \"hooks/data/useLoanableAmount\";\nimport useBorrow from \"hooks/payables/useBorrow\";\nimport handleTxError from \"util/handleTxError\";\nimport getReceipt from \"util/getReceipt\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nimport useMinBorrow from \"hooks/stats/marketSettingsStats/useMinBorrow\";\nimport { commify } from \"@ethersproject/units\";\nexport var BORROW_MODAL = \"borrow-modal\";\nexport var useBorrowModal = function useBorrowModal() {\n  _s();\n\n  return useModal(BORROW_MODAL);\n};\n\n_s(useBorrowModal, \"/NNgIfWkZNRQc9ayPIFGjHDwfuE=\", false, function () {\n  return [useModal];\n});\n\nexport function BorrowModal(_ref) {\n  _s2();\n\n  var _errors$amount;\n\n  var balanceOwed = _ref.balanceOwed,\n      fee = _ref.fee,\n      creditLimit = _ref.creditLimit,\n      paymentDueDate = _ref.paymentDueDate,\n      paymentPeriod = _ref.paymentPeriod,\n      isOverdue = _ref.isOverdue,\n      onComplete = _ref.onComplete;\n  var addActivity = useAddActivity();\n\n  var _useWeb3React = useWeb3React(),\n      library = _useWeb3React.library;\n\n  var borrow = useBorrow();\n\n  var _useBorrowModal = useBorrowModal(),\n      close = _useBorrowModal.close;\n\n  var _useMaxBorrow = useMaxBorrow(),\n      maxBorrow = _useMaxBorrow.data;\n\n  var _useLoanableAmount = useLoanableAmount(),\n      loanableAmount = _useLoanableAmount.data;\n\n  var _useMinBorrow = useMinBorrow(),\n      minBorrow = _useMinBorrow.data;\n\n  var _useForm = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\"\n  }),\n      errors = _useForm.errors,\n      formState = _useForm.formState,\n      register = _useForm.register,\n      watch = _useForm.watch,\n      handleSubmit = _useForm.handleSubmit,\n      setValue = _useForm.setValue;\n\n  var isDirty = formState.isDirty,\n      isSubmitting = formState.isSubmitting;\n  var watchAmount = watch(\"amount\", 0);\n  var amount = Number(watchAmount || 0);\n  var calcBalanceOwed = balanceOwed > 0 ? balanceOwed : 0;\n  var calcMaxIncludingFee = roundDown(creditLimit * (1 - fee));\n  var calculateFee = amount === calcMaxIncludingFee ? roundDown(creditLimit * fee) : amount * fee;\n  var amountWithFee = amount + calculateFee;\n  var calcNewBalanceOwed = calcBalanceOwed + amountWithFee;\n  var newBalanceOwed = calcNewBalanceOwed.toFixed(2);\n  var nextPaymentDue = paymentDueDate !== \"-\" && paymentDueDate !== \"No Payment Due\" && calcBalanceOwed > 0 ? paymentDueDate : paymentPeriod;\n\n  var validate = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(val) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (val) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.required);\n\n            case 2:\n              if (!isOverdue) {\n                _context.next = 4;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.overdueBalance);\n\n            case 4:\n              if (!isNaN(val)) {\n                _context.next = 6;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.notANumber);\n\n            case 6:\n              if (!(Number(val) > calcMaxIncludingFee)) {\n                _context.next = 8;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.notEnoughCredit);\n\n            case 8:\n              if (!(Number(val) > maxBorrow)) {\n                _context.next = 10;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.maxBorrow(maxBorrow));\n\n            case 10:\n              if (!(Number(val) > loanableAmount)) {\n                _context.next = 12;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.notEnoughPoolDAI);\n\n            case 12:\n              if (!(Number(val) < minBorrow)) {\n                _context.next = 14;\n                break;\n              }\n\n              return _context.abrupt(\"return\", errorMessages.minDAIBorrow(minBorrow));\n\n            case 14:\n              return _context.abrupt(\"return\", true);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function validate(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleBorrow = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var _amount, _yield$borrow, hash, _hash;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _amount = data.amount;\n              _context2.next = 4;\n              return borrow(_amount);\n\n            case 4:\n              _yield$borrow = _context2.sent;\n              hash = _yield$borrow.hash;\n              _context2.next = 8;\n              return getReceipt(hash, library, {\n                pending: \"Borrowing \".concat(_amount, \" DAI\"),\n                success: \"Borrowed \".concat(_amount, \" DAI\")\n              });\n\n            case 8:\n              if (typeof onComplete === \"function\") onComplete();\n              addActivity(activityLabels.borrow({\n                amount: _amount,\n                hash: hash\n              }));\n              close();\n              _context2.next = 18;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](0);\n              _hash = isHash(_context2.t0.message) && _context2.t0.message;\n              addActivity(activityLabels.borrow({\n                amount: data.amount,\n                hash: _hash\n              }, true));\n              handleTxError(_context2.t0, \"Failed to borrow \".concat(amount, \" DAI\"));\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 13]]);\n    }));\n\n    return function handleBorrow(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Borrow funds\",\n      onClose: close,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleBorrow),\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          children: /*#__PURE__*/_jsxDEV(Grid.Row, {\n            children: [/*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"Available credit\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(roundDown(creditLimit))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 121,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 117,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                size: \"medium\",\n                align: \"center\",\n                label: \"You owe\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: balanceOwed\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 129,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          mt: \"24px\",\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            type: \"number\",\n            ref: register({\n              validate: validate\n            }),\n            name: \"amount\",\n            label: \"Borrow\",\n            placeholder: \"0.0\",\n            suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 23\n            }, this),\n            caption: \"Max. \".concat(format(calcMaxIncludingFee), \" DAI\"),\n            onCaptionClick: function onCaptionClick() {\n              return setValue(\"amount\", calcMaxIncludingFee, {\n                shouldValidate: true,\n                shouldDirty: true\n              });\n            },\n            error: ((_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message) || false\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          mt: \"16px\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"Total including fee\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: [commify(amountWithFee), \" DAI\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"First Payment Due\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: nextPaymentDue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          justify: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: \"New balance owed\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Label, {\n            as: \"p\",\n            size: \"small\",\n            grey: 400,\n            children: [commify(newBalanceOwed), \" DAI\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fluid: true,\n          mt: \"18px\",\n          label: \"Borrow \".concat(commify(amount), \" DAI\"),\n          disabled: !isDirty,\n          loading: isSubmitting,\n          onClick: handleSubmit(handleBorrow),\n          fontSize: \"large\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(BorrowModal, \"IC4YFY16qQ6ryV+ITYM1e2JFhqo=\", false, function () {\n  return [useAddActivity, useWeb3React, useBorrow, useBorrowModal, useMaxBorrow, useLoanableAmount, useMinBorrow, useForm];\n});\n\n_c = BorrowModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"BorrowModal\");","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/BorrowModal.js"],"names":["ModalOverlay","Box","Input","Grid","Stat","Button","Label","Modal","Dai","useModal","format","roundDown","useForm","errorMessages","useMaxBorrow","useLoanableAmount","useBorrow","handleTxError","getReceipt","useWeb3React","useAddActivity","activityLabels","isHash","useMinBorrow","commify","BORROW_MODAL","useBorrowModal","BorrowModal","balanceOwed","fee","creditLimit","paymentDueDate","paymentPeriod","isOverdue","onComplete","addActivity","library","borrow","close","maxBorrow","data","loanableAmount","minBorrow","mode","reValidateMode","errors","formState","register","watch","handleSubmit","setValue","isDirty","isSubmitting","watchAmount","amount","Number","calcBalanceOwed","calcMaxIncludingFee","calculateFee","amountWithFee","calcNewBalanceOwed","newBalanceOwed","toFixed","nextPaymentDue","validate","val","required","overdueBalance","isNaN","notANumber","notEnoughCredit","notEnoughPoolDAI","minDAIBorrow","handleBorrow","hash","pending","success","message","shouldValidate","shouldDirty"],"mappings":"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","sourcesContent":["import {\n  ModalOverlay,\n  Box,\n  Input,\n  Grid,\n  Stat,\n  Button,\n  Label,\n} from \"@unioncredit/ui\";\nimport { Modal, Dai } from \"components-ui\";\nimport { useModal } from \"hooks/useModal\";\nimport format from \"util/formatValue\";\nimport { roundDown } from \"util/numbers\";\nimport { useForm } from \"react-hook-form\";\nimport errorMessages from \"util/errorMessages\";\nimport useMaxBorrow from \"hooks/data/useMaxBorrow\";\nimport useLoanableAmount from \"hooks/data/useLoanableAmount\";\nimport useBorrow from \"hooks/payables/useBorrow\";\nimport handleTxError from \"util/handleTxError\";\nimport getReceipt from \"util/getReceipt\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nimport useMinBorrow from \"hooks/stats/marketSettingsStats/useMinBorrow\";\nimport { commify } from \"@ethersproject/units\";\n\nexport const BORROW_MODAL = \"borrow-modal\";\n\nexport const useBorrowModal = () => useModal(BORROW_MODAL);\n\nexport function BorrowModal({\n  balanceOwed,\n  fee,\n  creditLimit,\n  paymentDueDate,\n  paymentPeriod,\n  isOverdue,\n  onComplete,\n}) {\n  const addActivity = useAddActivity();\n  const { library } = useWeb3React();\n  const borrow = useBorrow();\n  const { close } = useBorrowModal();\n  const { data: maxBorrow } = useMaxBorrow();\n  const { data: loanableAmount } = useLoanableAmount();\n  const { data: minBorrow } = useMinBorrow();\n\n  const { errors, formState, register, watch, handleSubmit, setValue } =\n    useForm({\n      mode: \"onChange\",\n      reValidateMode: \"onChange\",\n    });\n\n  const { isDirty, isSubmitting } = formState;\n\n  const watchAmount = watch(\"amount\", 0);\n  const amount = Number(watchAmount || 0);\n\n  const calcBalanceOwed = balanceOwed > 0 ? balanceOwed : 0;\n\n  const calcMaxIncludingFee = roundDown(creditLimit * (1 - fee));\n\n  const calculateFee =\n    amount === calcMaxIncludingFee\n      ? roundDown(creditLimit * fee)\n      : amount * fee;\n\n  const amountWithFee = amount + calculateFee;\n  const calcNewBalanceOwed = calcBalanceOwed + amountWithFee;\n  const newBalanceOwed = calcNewBalanceOwed.toFixed(2);\n\n  const nextPaymentDue =\n    paymentDueDate !== \"-\" &&\n    paymentDueDate !== \"No Payment Due\" &&\n    calcBalanceOwed > 0\n      ? paymentDueDate\n      : paymentPeriod;\n\n  const validate = async (val) => {\n    if (!val) return errorMessages.required;\n    if (isOverdue) return errorMessages.overdueBalance;\n    if (isNaN(val)) return errorMessages.notANumber;\n    if (Number(val) > calcMaxIncludingFee) return errorMessages.notEnoughCredit;\n    if (Number(val) > maxBorrow) return errorMessages.maxBorrow(maxBorrow);\n    if (Number(val) > loanableAmount) return errorMessages.notEnoughPoolDAI;\n    if (Number(val) < minBorrow) return errorMessages.minDAIBorrow(minBorrow);\n\n    return true;\n  };\n\n  const handleBorrow = async (data) => {\n    try {\n      const { amount } = data;\n      const { hash } = await borrow(amount);\n      await getReceipt(hash, library, {\n        pending: `Borrowing ${amount} DAI`,\n        success: `Borrowed ${amount} DAI`,\n      });\n      if (typeof onComplete === \"function\") onComplete();\n      addActivity(activityLabels.borrow({ amount, hash }));\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(activityLabels.borrow({ amount: data.amount, hash }, true));\n      handleTxError(err, `Failed to borrow ${amount} DAI`);\n    }\n  };\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"Borrow funds\" onClose={close}>\n        <form onSubmit={handleSubmit(handleBorrow)}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Available credit\"\n                  value={<Dai value={format(roundDown(creditLimit))} />}\n                />\n              </Grid.Col>\n              <Grid.Col>\n                <Stat\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"You owe\"\n                  value={<Dai value={balanceOwed} />}\n                />\n              </Grid.Col>\n            </Grid.Row>\n          </Grid>\n          <Box mt=\"24px\">\n            <Input\n              type=\"number\"\n              ref={register({ validate })}\n              name=\"amount\"\n              label=\"Borrow\"\n              placeholder=\"0.0\"\n              suffix={<Dai />}\n              caption={`Max. ${format(calcMaxIncludingFee)} DAI`}\n              onCaptionClick={() =>\n                setValue(\"amount\", calcMaxIncludingFee, {\n                  shouldValidate: true,\n                  shouldDirty: true,\n                })\n              }\n              error={errors.amount?.message || false}\n            />\n          </Box>\n          <Box justify=\"space-between\" mt=\"16px\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              Total including fee\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {commify(amountWithFee)} DAI\n            </Label>\n          </Box>\n          <Box justify=\"space-between\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              First Payment Due\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {nextPaymentDue}\n            </Label>\n          </Box>\n          <Box justify=\"space-between\">\n            <Label as=\"p\" size=\"small\" grey={400}>\n              New balance owed\n            </Label>\n            <Label as=\"p\" size=\"small\" grey={400}>\n              {commify(newBalanceOwed)} DAI\n            </Label>\n          </Box>\n          <Button\n            fluid\n            mt=\"18px\"\n            label={`Borrow ${commify(amount)} DAI`}\n            disabled={!isDirty}\n            loading={isSubmitting}\n            onClick={handleSubmit(handleBorrow)}\n            fontSize=\"large\"\n          />\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}