{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/mathewstokes/Desktop/stats-app/components-ui/modals/EditVouchModal.js\";\nimport { Grid, Button, ModalOverlay, Input, Stat } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport useCreditLimit from \"hooks/data/useCreditLimit\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\nexport const EDIT_VOUCH_MODAL = \"edit-vouch-modal\";\nexport const useEditVouchModal = () => useModal(EDIT_VOUCH_MODAL);\nexport function EditVouchModal({\n  address,\n  used,\n  trust\n}) {\n  var _errors$amount;\n\n  const addActivity = useAddActivity();\n  const {\n    library\n  } = useWeb3React();\n  const {\n    close\n  } = useEditVouchModal();\n  const adjustTrust = useAdjustTrust();\n  const {\n    mutate: updateTrustData\n  } = useTrustData();\n  const {\n    mutate: updateCreditLimit\n  } = useCreditLimit();\n  const {\n    register,\n    formState,\n    errors,\n    handleSubmit\n  } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\"\n  });\n  const {\n    isDirty,\n    isSubmitting\n  } = formState;\n\n  const validate = val => {\n    if (Number(val) <= used) return errorMessages.cantRemoveStake;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n    return true;\n  };\n\n  const handleAdjustTrust = async values => {\n    try {\n      const {\n        hash\n      } = await adjustTrust(address, values.amount);\n      await getReceipt(hash, library);\n      addActivity(activityLabels.adjustVouch({\n        address,\n        amount: values.amount,\n        hash\n      }));\n      await updateTrustData();\n      await updateCreditLimit();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(activityLabels.adjustVouch({\n        address,\n        amount: values.amount,\n        hash\n      }, true));\n      handleTxError(err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ModalOverlay, {\n    onClick: close,\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      title: \"Change trust amount\",\n      onClose: close,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleAdjustTrust),\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          children: /*#__PURE__*/_jsxDEV(Grid.Row, {\n            children: [/*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                mb: \"24px\",\n                size: \"medium\",\n                align: \"center\",\n                label: \"Current trust\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(trust, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 77,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 72,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 71,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Grid.Col, {\n              children: /*#__PURE__*/_jsxDEV(Stat, {\n                mb: \"24px\",\n                size: \"medium\",\n                align: \"center\",\n                label: \"Unpaid debt\",\n                value: /*#__PURE__*/_jsxDEV(Dai, {\n                  value: format(used, 4)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 86,\n                  columnNumber: 26\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 81,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 80,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          type: \"number\",\n          ref: register({\n            validate\n          }),\n          name: \"amount\",\n          label: \"New trust amount\",\n          suffix: /*#__PURE__*/_jsxDEV(Dai, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 21\n          }, this),\n          error: (_errors$amount = errors.amount) === null || _errors$amount === void 0 ? void 0 : _errors$amount.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          mt: \"18px\",\n          fluid: true,\n          label: \"Save\",\n          fontSize: \"large\",\n          type: \"submit\",\n          disabled: !isDirty,\n          loading: isSubmitting\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/mathewstokes/Desktop/stats-app/components-ui/modals/EditVouchModal.js"],"names":["Grid","Button","ModalOverlay","Input","Stat","useModal","Dai","Modal","format","errorMessages","useForm","getReceipt","handleTxError","useAdjustTrust","useTrustData","useWeb3React","useCreditLimit","useAddActivity","activityLabels","isHash","EDIT_VOUCH_MODAL","useEditVouchModal","EditVouchModal","address","used","trust","addActivity","library","close","adjustTrust","mutate","updateTrustData","updateCreditLimit","register","formState","errors","handleSubmit","mode","reValidateMode","isDirty","isSubmitting","validate","val","Number","cantRemoveStake","minValueZero","required","handleAdjustTrust","values","hash","amount","adjustVouch","err","message"],"mappings":"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","sourcesContent":["import { Grid, Button, ModalOverlay, Input, Stat } from \"@unioncredit/ui\";\nimport { useModal } from \"hooks/useModal\";\nimport { Dai, Modal } from \"components-ui\";\nimport format from \"util/formatValue\";\nimport errorMessages from \"util/errorMessages\";\nimport { useForm } from \"react-hook-form\";\nimport getReceipt from \"util/getReceipt\";\nimport handleTxError from \"util/handleTxError\";\nimport useAdjustTrust from \"hooks/payables/useAdjustTrust\";\nimport useTrustData from \"hooks/data/useTrustData\";\nimport { useWeb3React } from \"@web3-react/core\";\nimport useCreditLimit from \"hooks/data/useCreditLimit\";\nimport { useAddActivity } from \"hooks/data/useActivity\";\nimport activityLabels from \"util/activityLabels\";\nimport isHash from \"util/isHash\";\n\nexport const EDIT_VOUCH_MODAL = \"edit-vouch-modal\";\n\nexport const useEditVouchModal = () => useModal(EDIT_VOUCH_MODAL);\n\nexport function EditVouchModal({ address, used, trust }) {\n  const addActivity = useAddActivity();\n  const { library } = useWeb3React();\n  const { close } = useEditVouchModal();\n  const adjustTrust = useAdjustTrust();\n  const { mutate: updateTrustData } = useTrustData();\n  const { mutate: updateCreditLimit } = useCreditLimit();\n\n  const { register, formState, errors, handleSubmit } = useForm({\n    mode: \"onChange\",\n    reValidateMode: \"onChange\",\n  });\n  const { isDirty, isSubmitting } = formState;\n\n  const validate = (val) => {\n    if (Number(val) <= used) return errorMessages.cantRemoveStake;\n    if (Number(val) <= 0) return errorMessages.minValueZero;\n    if (!val) return errorMessages.required;\n\n    return true;\n  };\n\n  const handleAdjustTrust = async (values) => {\n    try {\n      const { hash } = await adjustTrust(address, values.amount);\n      await getReceipt(hash, library);\n      addActivity(\n        activityLabels.adjustVouch({ address, amount: values.amount, hash })\n      );\n      await updateTrustData();\n      await updateCreditLimit();\n      close();\n    } catch (err) {\n      const hash = isHash(err.message) && err.message;\n      addActivity(\n        activityLabels.adjustVouch(\n          { address, amount: values.amount, hash },\n          true\n        )\n      );\n      handleTxError(err);\n    }\n  };\n\n  return (\n    <ModalOverlay onClick={close}>\n      <Modal title=\"Change trust amount\" onClose={close}>\n        <form onSubmit={handleSubmit(handleAdjustTrust)}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Col>\n                <Stat\n                  mb=\"24px\"\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Current trust\"\n                  value={<Dai value={format(trust, 4)} />}\n                />\n              </Grid.Col>\n              <Grid.Col>\n                <Stat\n                  mb=\"24px\"\n                  size=\"medium\"\n                  align=\"center\"\n                  label=\"Unpaid debt\"\n                  value={<Dai value={format(used, 4)} />}\n                />\n              </Grid.Col>\n            </Grid.Row>\n          </Grid>\n          <Input\n            type=\"number\"\n            ref={register({ validate })}\n            name=\"amount\"\n            label=\"New trust amount\"\n            suffix={<Dai />}\n            error={errors.amount?.message}\n          />\n          <Button\n            mt=\"18px\"\n            fluid\n            label=\"Save\"\n            fontSize=\"large\"\n            type=\"submit\"\n            disabled={!isDirty}\n            loading={isSubmitting}\n          />\n        </form>\n      </Modal>\n    </ModalOverlay>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}